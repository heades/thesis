In Chapter~\ref{chap:freedom_of_speech} we defined the Freedom of
Speech language in its entirety.  We now introduce its analysis.  The
main results consist of logical consistency of the logical fragment
and type preservation.  The former is shown by proving weak
normalization of the logical fragment -- the reader may wish to recall
the definition of weak normalization; see
Definition~\ref{def:weak_norm} of
Chapter~\ref{chap:metatheory_of_programming_languages}.  The remainder
of this chapter proceeds by first introducing some basic lemmas to
which the main results will depend.  Then we prove type preservation,
and following this we will prove weak normalization.

\section{Basic Results}
\label{sec:basic_results}
The main results depend on several auxiliary results, and we present
each of them in this section.  The first is regularity, which
insures that if an expression has a type, then its type is well typed.
Recall that in the logical fragment $[[Type]] : [[Type]]$ does not hold, thus
if $[[e]]$ is joinable with $[[Type]]$, then $[[G |- e' : e L]]$ does
not imply that $[[G |- e : Type L]]$.  However, this does hold in the
programmatic fragment.  Therefore, regularity has the following
statement and proof.

\begin{lemma}[Regularity]
  \label{lemma:regularity}
  \begin{itemize}
  \item[i.] If $[[G |- e':e L]]$ and it is not the case that $[[e \v/ Type]]$, then $[[G |- e:Type L]]$.
  \item[ii.] If $[[G |- e':e C]]$ then $[[G |- e:Type C]]$.
  \end{itemize}
\end{lemma}
\begin{proof}
  This is a proof by induction on the form of the assumed typing
  derivation.  The most interesting cases are presented below; all
  other cases are either similar to the cases given here or are
  trivial.  If it is not the case that $[[e \v/ Type]]$, then both
  proofs can be given simultaneously.  In fact, the proof of part ii
  when $[[e \v/ Type]]$ holds is trivial, thus we do not present it
  here.
  
  \begin{itemize}
  % \item[Case.] \ \\
  %   \begin{center}
  %     $\FSdruleVar{}$
  %   \end{center}
  %   Trivial.

  \item[Case.] \ \\
    \begin{center}
      $\FSdruleLam{}$
    \end{center}
    By assumption we know $\Gamma \tvdash{\theta} e_1:[[Type]]$ and by the induction hypothesis,
    $\Gamma,x:^\theta e_1 \tvdash{\theta'} e_2:[[Type]]$. Finally by applying 
    $\FSdrulename{K\_Pi}$, $\Gamma \tvdash{\theta'} \arrowT{x}{\theta}{e_1}{+}{e_2}:[[Type]]$.

  % \item[Case.] \ \\
  %   \begin{center}
  %     $\FSdruleILam{}$
  %   \end{center}
  %   Similar to the previous case.

  \item[Case.] \ \\
    \begin{center}
      $\FSdruleAppPiTerm{}$
    \end{center}
    By the induction hypothesis, $\Gamma \tvdash{\theta'} \arrowT{x}{\theta}{e_1}{+}{e_2}:[[Type]]$
    and by inversion of $\FSdrulename{K\_Pi}$, $\Gamma, x:^\theta e_1 \tvdash{\theta'} e_2:[[Type]]$.
    Finally, by the subsitution lemma $\Gamma \tvdash{\theta'} [v/x]e_2:[[Type]]$.

  % \item[Case.] \ \\
  %   \begin{center}
  %     $\FSdruleAppAllTerm{}$ 
  %   \end{center}
  %   Similar to the previous case.

  \item[Case.] \ \\
    \begin{center}
      $\FSdrulejoin{}$
    \end{center}
    By assumption $\Gamma \tvdash{\theta_1} e:e_1$ and $\Gamma \tvdash{\theta_2} e':e_2$.  
    Therefore, by $\FSdrulename{K\_Eq}$ $\Gamma \tvdash e = e':[[Type]]$.

  \item[Case.] \ \\
    \begin{center}
      $\FSdruleInjDom{}$
    \end{center}
    By the induction hypothesis, 
    $\Gamma \tvdash{L} (\arrowT{x}{\theta}{e_1}{\epsilon}{e_2}) = 
    (\arrowT{x}{\theta}{e'_1}{\epsilon}{e'_2}):[[Type]]$, hence by inversion of 
    $\FSdrulename{K\_Eq}$ we know
    $\Gamma \tvdash{\theta_1} \arrowT{x}{\theta}{e_1}{\epsilon}{e_2}:[[Type]]$ and
    $\Gamma \tvdash{\theta_2} \arrowT{x}{\theta}{e'_1}{\epsilon}{e'_2}:[[Type]]$ for some $\theta_1$
    and $\theta_2$.  We can apply inversion one more time, but this time to 
    $\FSdrulename{K\_Pi}$ to obtain $\Gamma \tvdash{\theta} e_1:[[Type]]$ and 
    $\Gamma \tvdash{\theta} e'_1:[[Type]]$.  Now by 
    $\FSdrulename{K\_Eq}$, $\Gamma \tvdash{L} e_1 = e'_1:[[Type]]$.

  \item[Case.] \ \\
    \begin{center}
      $\FSdruleInjRan{}$
    \end{center}
    We first apply $\FSdrulename{InjDom}$ to obtain $\Gamma \tvdash{L} injdom:e_1 = e'_1$.
    By the induction hypothesis, 
    $\Gamma \tvdash{L} (\arrowT{x}{\theta}{e_1}{\epsilon}{e_2}) = 
    (\arrowT{x}{\theta}{e'_1}{\epsilon}{e'_2}):[[Type]]$, hence by inversion of 
    $\FSdrulename{K\_Eq}$ we know
    $\Gamma \tvdash{\theta'} \arrowT{x}{\theta}{e_1}{\epsilon}{e_2}:[[Type]]$ and
    $\Gamma \tvdash{\theta'} \arrowT{x}{\theta}{e'_1}{\epsilon}{e'_2}:[[Type]]$ for some $\theta'$
    and $\theta'$.  We can apply inversion one more time, but this time to 
    $\FSdrulename{K\_Pi}$ to obtain $\Gamma,x:^\theta e_1 \tvdash{\theta'} e_2:[[Type]]$ and 
    $\Gamma,x:^\theta e'_1 \tvdash{\theta} e'_1:[[Type]]$.  By assumption we know
    $\Gamma \tvdash{\theta} v:e_1$, hence by the substitution lemma 
    $\Gamma \tvdash{\theta'}[v/x]e_2:[[Type]]$.  Now by applying $\FSdrulename{Conv}$ using
    $\Gamma \tvdash{\theta} v:e_1$ and $\Gamma \tvdash{L} injdom:e_1 = e'_1$ we obtain
    $\Gamma \tvdash{\theta} v:e'_1$.  Again by the substitution lemma, 
    $\Gamma \tvdash{\theta'} [v/x]e'_2$.  Finally, we apply $\FSdrulename{K\_Eq}$ to conclude
    $\Gamma \tvdash{L} injran:[v/x]e_2 = [v/x]e'_2$.

  \item[Case.] \ \\
    \begin{center}
      $\FSdruleConv{}$
    \end{center}
    By the induction hypothesis, $\Gamma \tvdash{\theta} [e_1/x]e_2:[[Type]]$ and by the kinding 
    conversion lemma, $\Gamma \tvdash{\theta} [e'_1/x]e_2:[[Type]]$.

  \item[Case.] \ \\
    \begin{center}
      $\FSdruleSucc{}$
    \end{center}
    By $\FSdrulename{K\_Nat}$, $\Gamma \tvdash{L} \nat:[[Type]]$ and 
    $\Gamma,x:^L \nat \tvdash{L} \nat:[[Type]]$.  Finally, by $\FSdrulename{K\_Pi}$,
    $\Gamma \tvdash{L} \arrowT{x}{L}{\nat}{+}{\nat}$.
    
    
  % \item[Case.] \ \\
  %   \begin{center}
  %     $\FSdruleZero{}$
  %   \end{center}
  %   Trivial.

  % \item[Case.] \ \\
  %   \begin{center}
  %     $\FSdruleAbort{}$  
  %   \end{center}
  %   Trivial.

  % \item[Case.] \ \\
  %   \begin{center}
  %     $\FSdruleContra{}$
  %   \end{center}
  %   Trivial.

  % \item[Case.] \ \\
  %   \begin{center}
  %     $\FSdruleContraAbort{}$
  %   \end{center}
  %   Trivial.

  % \item[Case.] \ \\
  %   \begin{center}
  %     $\FSdruleContraPiTh{}$
  %   \end{center}
  %   Trivial.

  % \item[Case.] \ \\
  %   \begin{center}
  %     $\FSdruleContraPiEp{}$
  %   \end{center}
  %   Trivial.

  \item[Case.] \ \\
    \begin{center}
      $\FSdruleCoerce{}$
    \end{center}
    By the induction hypothesis, $\Gamma \tvdash{L} e_1:[[Type]]$ and by applying 
    $\FSdrulename{Coerce}$, $\Gamma \tvdash{P} e_1:[[Type]]$.

  \item[Case.] \ \\
    \begin{center}
      $\FSdruleRecNat{}$
    \end{center}
    By the induction hypothesis, 
    $\Gamma, x:^L \nat,
    f:^L \arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x=S\ y}{-}{[y/x]e_2}} \tvdash{L} e_2:[[Type]]$.  Since
    $f$ is not free in $e_2$ we know $\Gamma, x:^L \nat \tvdash{L} e_2:[[Type]]$.  Finally,
    by $\FSdrulename{K\_Pi}$ using $\Gamma, x:^L \nat \tvdash{L} e_2:[[Type]]$ and
    $\FSdrulename{K\_Nat}$, $\Gamma \tvdash{L} \arrowT{x}{L}{\nat}{+}{e_2}:[[Type]]$.

  % \item[Case.] \ \\
  %   \begin{center}
  %     $\FSdruleRecNatComp{}$
  %   \end{center}
  %   Similar to the previous case.

  \item[Case.] \ \\
    \begin{center}
      $\FSdruleRec{}$
    \end{center}
    By assumption $\Gamma \tvdash{\theta'} e_1:[[Type]]$ and by the induction hypothesis
    $\Gamma, f:^\theta \arrowT{x}{\theta'}{e_1}{+}{e_2},x:^{\theta'} e_1 \tvdash{\theta} e_2:[[Type]]$.
    Now by $\FSdrulename{K\_Pi}$, $\Gamma, f:^\theta \arrowT{x}{\theta'}{e_1}{+}{e_2} 
    \tvdash{\theta} \arrowT{x}{\theta'}{e_1}{+}{e_2}:[[Type]]$. Clearly, $f$ is not free in
    $\arrowT{x}{\theta'}{e_1}{+}{e_2}$, thus, 
    $\Gamma \tvdash{\theta} \arrowT{x}{\theta'}{e_1}{+}{e_2}:[[Type]]$.

  \end{itemize}
\end{proof}

The second basic result is substitution for typing.  This states that
if we know a term $[[e]]$ is well typed in an environment with a free
variable $[[x]]$, and given a value $[[v]]$ with the same type as the
free variable, then $[[ [v/x]e]]$ has the same type as $[[e]]$.  This
is an important result for type preservation, because we want to
insure that for any $[[(\x.e) v]]$ that has type $[[e']]$ the
contractum of $[[(\x.e) v]]$, $[[ [v/x]e]]$, has type $[[e']]$.

\begin{lemma}[Substitution for Typing]
  \label{lemma:substitution}
  % \begin{itemize}
  % \item[i.] If $\Gamma,x:^\theta e_1,\Gamma' \tvdash{\theta'} e:[[Type]]$ and 
  %   $\Gamma \tvdash{\theta} v:e_1$ 
  %   then $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]e:[[Type]]$.
  % \item[ii.]
  If $\Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta'} e:e_1$ and 
  $\Gamma \tvdash{\theta} v:e_2$, 
  then $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]e:[v/x]e_1$.
  % \end{itemize}
\end{lemma}
\begin{proof}
  This is a proof by induction on the form of the assumed typing
  derivation. We only give the non-trivial cases.  All other cases are
  either similar to the cases given here or are trivial.
  \begin{itemize}
  % \item[Case.] \ \\
    % \begin{center}
    %   \begin{math}
    %     $$\mprset{flushleft}
    %     \inferrule* [right=$K\_[[Type]]$ ] {
    %       \ 
    %     }{\Gamma,x:^\theta e_1,\Gamma' \tvdash{P} [[Type]]:[[Type]]}
    %   \end{math}
    % \end{center}
    % Trivial.

  % \item[Case.]\ \\
  %   \begin{center}
  %     \begin{math}
  %       $$\mprset{flushleft}
  %       \inferrule* [right=K\_Nat] {
  %         \ 
  %       }{\Gamma,x:^\theta e_1,\Gamma' \tvdash{L} \nat:[[Type]]}
  %     \end{math}
  %   \end{center}
  %   Trivial.

  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=K\_Pi] {
          \Gamma,x:^\theta e_1,\Gamma' \tvdash{\theta''} e'_1:[[Type]]
          \\\\
          \Gamma,x:^\theta e_1,\Gamma',y:^{\theta''} e'_1 \tvdash{\theta'} e_2:[[Type]]
   }{\Gamma,x:^\theta e_1,\Gamma' \tvdash{\theta'} \arrowT{y}{\theta''}{e'_1}{\epsilon}{e_2}:[[Type]]}
      \end{math}
    \end{center}
    By the induction hypothesis, 
    $\Gamma,[v/x]\Gamma' \tvdash{\theta''} [v/x]e'_1:[[Type]]$ and
    $\Gamma,[v/x]\Gamma',y:^{\theta''} [v/x]e'_1 \tvdash{\theta'} [v/x]e_2:[[Type]]$.  Now we can
    apply $\FSdrulename{K\_Pi}$ to obtain, 
 $\Gamma,[v/x]\Gamma' \tvdash{\theta'} \arrowT{y}{\theta''}{[v/x]e'_1}{\epsilon}{[v/x]e_2}:[[Type]]$,
    which is equivalent to
  $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x](\arrowT{y}{\theta''}{e'_1}{\epsilon}{e_2}):[[Type]]$.
    
    \item[Case.]\ \\
      \begin{center}
        \begin{math}
          $$\mprset{flushleft}
          \inferrule* [right=K\_Eq] {
            \Gamma,x:^\theta e_1,\Gamma' \tvdash{\theta_1} e:e'_1
            \\\\
            \Gamma,x:^\theta e_1,\Gamma' \tvdash{\theta_2} e':e_2
          }{\Gamma,x:^\theta e_1,\Gamma' \tvdash{L} e = e':[[Type]]}
        \end{math}
      \end{center}
      By the induction hypothesis we know 
      $\Gamma,[v/x]\Gamma' \tvdash{\theta_1} [v/x]e:[v/x]e'_1$ and
      $\Gamma,[v/x]\Gamma' \tvdash{\theta_2} [v/x]e':[v/x]e'_2$.  We can now apply 
      $\FSdrulename{K\_Eq}$ to obtain $\Gamma,[v/x]\Gamma' \tvdash{L} [v/x]e = [v/x]e':[[Type]]$,
      which is equivalent to $\Gamma,[v/x]\Gamma' \tvdash{L} [v/x](e = e'):[[Type]]$.

  \item[Case.]\ \\
     \begin{center}
       \begin{math}
         $$\mprset{flushleft}
         \inferrule* [right=\FSdrulename{Var}]{
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta'} e_1:[[Type]]
           \\\\
           y:^{\theta'} e_1 \in (\Gamma,x:^\theta e_2,\Gamma')
         }{\Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta'} y:^{\theta'} e_1}
       \end{math}
     \end{center}
     By the induction hypothesis we know
     $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]e_1:[[Type]]$.  Clearly, if 
     $y:^{\theta'} e_1 \in (\Gamma,x:^\theta e_2,\Gamma')$ then
     $y:^{\theta'} [v/x]e_1 \in (\Gamma,[v/x]\Gamma')$.  Thus,
     by applying $\FSdrulename{Var}$, 
     $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]y:^{\theta'} [v/x]e_1$.     

   \item[Case.]\ \\
     \begin{center}
       \begin{math}
         $$\mprset{flushleft}
         \inferrule* [right=\FSdrulename{Lam}] {
           \Gamma, x:^\theta e_2,\Gamma' \tvdash{\theta'} e'_1:[[Type]]
           \\\\
           \Gamma, x:^\theta e_2,\Gamma',y:^{\theta''} e'_1 \tvdash{\theta'} e:e''_1
         }{\Gamma, x:^\theta e_2,\Gamma' \tvdash{\theta'} 
           \lambda y.e:\arrowT{y}{\theta''}{e'_1}{+}{e''_1}}
       \end{math}
     \end{center}
     By the induction hypothesis we know 
     $\Gamma, [v/x]\Gamma' \tvdash{\theta'} [v/x]e'_1:[[Type]]$ and 
     $\Gamma, [v/x]\Gamma',y:^{\theta''} [v/x]e'_1 \tvdash{\theta'} [v/x]e:[v/x]e''_1$. Finally,
     by applying $\FSdrulename{Lam}$, 
     $\Gamma, [v/x]\Gamma' \tvdash{\theta'} 
     \lambda y.[v/x]e:\arrowT{y}{\theta''}{[v/x]e'_1}{+}{[v/x]e''_1}$, which is equivalent to
     $\Gamma, [v/x]\Gamma' \tvdash{\theta'} 
     [v/x](\lambda y.e):[v/x](\arrowT{y}{\theta''}{e'_1}{+}{e''_1})$.     

   \item[Case.]\ \\
     \begin{center}
       \begin{math}
         $$\mprset{flushleft}
         \inferrule* [right=\FSdrulename{ILam}] {
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta''} e'_1:[[Type]]
           \\\\
           \Gamma,x:^\theta e_2,\Gamma',y:^{\theta''} e'_1 \tvdash{\theta'} v':e''_1
           \\\\
           y \not \in fvs(v')
         }{\Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta'} v':\arrowT{y}{\theta''}{e'_1}{-}{e''_1}}
       \end{math}
     \end{center}
     By the induction hypothesis we know 
     $\Gamma,[v/x]\Gamma' \tvdash{\theta''} [v/x]e'_1:[[Type]]$ and
     $\Gamma,[v/x]\Gamma',y:^{\theta''} [v/x]e'_1 \tvdash{\theta'} [v/x]v':[v/x]e''_1$.  Finally,
     by applying $\FSdrulename{ILam}$, 
   $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]v':\arrowT{y}{\theta''}{[v/x]e'_1}{-}{[v/x]e''_1}$
     which is equivalent to 
   $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]v':[v/x](\arrowT{y}{\theta''}{e'_1}{-}{e''_1})$.

   \item[Case.]\ \\
     \begin{center}
       \begin{math}
         $$\mprset{flushleft}
         \inferrule*[right=\FSdrulename{AppPiTerm}]{
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta'} e:\arrowT{y}{\theta''}{e'_1}{+}{e''_1}
           \\\\
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta''} v':e''_1
         }{\Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta'} e\ v':[v'/y]e''_1}
       \end{math}
     \end{center}
     By the induction hypothesis we know 
     $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]e:\arrowT{y}{\theta''}{[v/x]e'_1}{+}{[v/x]e''_1}$
     and
     $\Gamma,[v/x]\Gamma' \tvdash{\theta''} [v/x]v':[v/x]e''_1$.  By applying 
     $\FSdrulename{AppPiTerm}$, 
     $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x](e\ v'):[v/x]([v'/y]e''_1)$.

   \item[Case.]\ \\
     \begin{center}
       \begin{math}
         $$\mprset{flushleft}
         \inferrule*[right=\FSdrulename{AppAllTerm}]{
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta'} e:\arrowT{y}{\theta''}{e'_1}{-}{e''_1}
           \\\\
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta''} v':e''_1
         }{\Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta'} e:[v'/y]e''_1}
       \end{math}
     \end{center}
     By the induction hypothesis we know 
     $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]e:\arrowT{y}{\theta''}{[v/x]e'_1}{-}{[v/x]e''_1}$
     and
     $\Gamma,[v/x]\Gamma' \tvdash{\theta''} [v/x]v':[v/x]e''_1$.  Lastly by applying 
     $\FSdrulename{AppAllTerm}$,
     $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]e:[v/x]([v'/y]e''_1)$.

   \item[Case.]\ \\
     \begin{center}
       \begin{math}
         $$\mprset{flushleft}
         \inferrule* [right=\FSdrulename{Join}] {
           e \join e'
           \\\\
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta_1} e:e'_1
           \\\\
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta_2} e':e''_1
         }{\Gamma,x:^\theta e_2,\Gamma' \tvdash{L} join : e = e'}
       \end{math}
     \end{center}
     It is a well-known property that if $e \join e'$ then $[v/x]e \join [v/x]e'$.  By the 
     induction hypothesis, $\Gamma,[v/x]\Gamma' \tvdash{\theta_1} [v/x]e:[v/x]e'_1$ and
     $\Gamma,[v/x]\Gamma' \tvdash{\theta_2} [v/x]e':[v/x]e''_1$.  Finally by 
     $\FSdrulename{Join}$, $\Gamma,[v/x]\Gamma' \tvdash{L} join : [v/x](e = e')$.

   \item[Case.]\ \\
     \begin{center}
       \begin{math}
         $$\mprset{flushleft}
         \inferrule* [right=\FSdrulename{InjDom}] {
           \Gamma,x:^\theta e_2,\Gamma \tvdash{L} e':(\arrowT{x}{\theta}{e'_1}{+}{e'_2}) = 
           (\arrowT{x}{\theta}{e''_1}{+}{e''_2})
         }{\Gamma,x:^\theta e_2,\Gamma' \tvdash{L} injdom : e'_1 = e''_1}
       \end{math}
     \end{center}
     By the induction of hypothesis, \\
     $\Gamma,[v/x]\Gamma \tvdash{L} [v/x]e':(\arrowT{x}{\theta}{[v/x]e'_1}{+}{[v/x]e'_2}) = 
     (\arrowT{x}{\theta}{[v/x]e''_1}{+}{[v/x]e''_2})$.  Now by applying $\FSdrulename{InjDom}$,
     $\Gamma,[v/x]\Gamma' \tvdash{L} injdom : [v/x](e'_1 = e''_1)$.

   % \item[Case.]\ \\
   %   \begin{center}
   %     \begin{math}
   %       $$\mprset{flushleft}
   %       \inferrule* [right=\FSdrulename{InjRan}] {
   %         \Gamma \tvdash{L} e':(\arrowT{x}{\theta}{e_1}{+}{e_2}) = 
   %         (\arrowT{x}{\theta}{e'_1}{+}{e'_2})
   %         \\\\
   %         \Gamma \tvdash{\theta} v:e_1
   %       }{\Gamma \tvdash{L} injran : [v/x]e_2 = [v/x]e'_2}
   %     \end{math}
   %   \end{center}
   %   Similar to the previous case.

   \item[Case.]\ \\
     \begin{center}
       \begin{math}
         $$\mprset{flushleft}
         \inferrule* [right=\FSdrulename{Conv}] {
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta'} e:[e'/y]e'_1
           \\\\
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{L} p:e' = e''
         }{\Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta'} e:[e''/y]e'_1}
       \end{math}
     \end{center}
     By the induction hypothesis we know 
     $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]e:[v/x]([e'/y]e'_1)$ and
     $\Gamma,[v/x]\Gamma' \tvdash{L} p:[v/x]e' = [v/x]e''$.  By applying $\FSdrulename{Conv}$,
     $\Gamma,[v/x]\Gamma' \tvdash{\theta'} [v/x]e:[v/x]([e''/y]e'_1)$.

   % \item[Case.]\ \\
   %   \begin{center}
   %     \begin{math}
   %       $$\mprset{flushleft}
   %       \inferrule* [right=\FSdrulename{Succ}] {
   %         \ 
   %       }{\Gamma, x:^\theta e_2,\Gamma' \tvdash{L} S:\arrowT{y}{L}{\nat}{+}{\nat}}
   %     \end{math}
   %   \end{center}
   %   Trivial.

   % \item[Case.]\ \\
   %   \begin{center}
   %     \begin{math}
   %       $$\mprset{flushleft}
   %       \inferrule* [right=\FSdrulename{Zero}] {
   %         \ 
   %       }{\Gamma, x:^\theta e_2,\Gamma' \tvdash{L} Z:\nat}
   %     \end{math}
   %   \end{center}
   %   Trivial.
     
   \item[Case.]\ \\
     \begin{center}
       \begin{math}
         $$\mprset{flushleft}
         \inferrule* [right=\FSdrulename{Abort}] {
           \Gamma, x:^\theta e_2,\Gamma' \tvdash{\theta} e_1:[[Type]]
         }{\Gamma, x:^\theta e_2,\Gamma' \tvdash{P} abort:e_1}
       \end{math}
     \end{center}
     By the induction hypothesis we know 
     $\Gamma, [v/x]\Gamma' \tvdash{\theta} [v/x]e_1:[[Type]]$ and by applying
     $\FSdrulename{Abort}$ we obtain 
     $\Gamma, [v/x]\Gamma' \tvdash{P} abort:[v/x]e_1$.

   % \item[Case.]\ \\
   %   \begin{center}
   %     \begin{math}
   %       $$\mprset{flushleft}
   %       \inferrule* [right=\FSdrulename{Contra}] {
   %         \Gamma, x:^\theta e_2,\Gamma' \tvdash{\theta} e_1:[[Type]]
   %         \\\\
   %         \Gamma, x:^\theta e_2,\Gamma' \tvdash{L} e:Z = S\ e'
   %       }{\Gamma, x:^\theta e_2,\Gamma' \tvdash{L} contra:e_1}
   %     \end{math}
   %   \end{center}
   %   Similar to the previous case.

   % \item[Case.]\ \\
   %   \begin{center}
   %     \begin{math}
   %       $$\mprset{flushleft}
   %       \inferrule* [right=\FSdrulename{ContraAbort}] {
   %         \Gamma, x:^\theta e_2,\Gamma' \tvdash{\theta} e_1:[[Type]]
   %         \\\\
   %         \Gamma, x:^\theta e_2,\Gamma' \tvdash{L} e:v = abort
   %       }{\Gamma, x:^\theta e_2,\Gamma' \tvdash{L} contra:e_1}
   %     \end{math}
   %   \end{center}
   %   Similar to the previous case.

   \item[Case.]\ \\
     \begin{center}
       \begin{math}
     $$\mprset{flushleft}
         \inferrule* [right=\FSdrulename{ContraPiTh}] {
           \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta''} e:[[Type]]
           \\\\
     \Gamma,x:^\theta e_2,\Gamma' \tvdash{L} e':(\arrowT{x}{\theta}{e'_1}{\epsilon}{e'_2}) = 
     (\arrowT{x}{\theta'}{e''_1}{\epsilon'}{e''_2})
     \\\\
     \theta \neq \theta'
     }{\Gamma,x:^\theta e_2,\Gamma' \tvdash{L} contra : e}
       \end{math}
     \end{center}
     By the induction hypothesis we know $\Gamma,[v/x]\Gamma' \tvdash{\theta} [v/x]e:[[Type]]$ 
     and $\Gamma,[v/x]\Gamma' \tvdash{L} [v/x]e':[v/x]((\arrowT{x}{\theta}{e'_1}{+}{e'_2}) = 
     (\arrowT{x}{\theta}{e''_1}{+}{e''_2}))$ and by applying $\FSdrulename{ContrapiTh}$,
     $\Gamma,[v/x]\Gamma' \tvdash{L} contra : [v/x]e$.

   % \item[Case.]\ \\
   %   \begin{center}
   %     \begin{math}
   %       $$\mprset{flushleft}
   %       \inferrule* [right=\FSdrulename{ContraPiEp}] {
   %         \Gamma,x:^\theta e_2,\Gamma' \tvdash{\theta''} e:[[Type]]
   %         \\\\
   %   \Gamma,x:^\theta e_2,\Gamma' \tvdash{L} e':(\arrowT{x}{\theta'}{e_1}{\epsilon}{e_2}) = 
   %   (\arrowT{x}{\theta}{e'_1}{\epsilon'}{e'_2})
   %   \\\\
   %   \epsilon \neq \epsilon'
   %       }{\Gamma,x:^\theta e_2,\Gamma' \tvdash{L} contra : e}
   %     \end{math}
   %   \end{center}
   %   Similar to the previous case.

   % \item[Case.]\ \\
   %   \begin{center}
   %     \begin{math}
   %       $$\mprset{flushleft}
   %       \inferrule* [right=\FSdrulename{Coerce}] {
   %         \Gamma, x:^\theta e_2,\Gamma' \tvdash{L} e:e_1
   %       }{\Gamma, x:^\theta e_2,\Gamma' \tvdash{P} e:e_1}
   %     \end{math}
   %   \end{center}
   %   Similar to the previous case.

   \item[Case.]\ \\
     \begin{center}
       \small
       \begin{math}
         $$\mprset{flushleft}
         \inferrule* [right=\FSdrulename{RecNat}] {
           \Gamma, x:^\theta e_2,\Gamma',y:^L \nat \tvdash{L} 
           \arrowT{z}{L}{\nat}{+}{\arrowT{p}{L}{y=S\ z}{-}{[z/y]e_2}}:[[Type]]
           \\\\
           \Gamma, x:^\theta e_2,\Gamma',y:^L \nat,
           f:^L \arrowT{z}{L}{\nat}{+}{\arrowT{p}{L}{y=S\ z}{-}{[z/y]e_2}} \tvdash{L}
           v':e_2
           \\\\
           f,p \not \in FV(e_2)
         }
         {\Gamma, x:^\theta e_2,\Gamma' \tvdash{L} \rec{f}{y}{v'}:\arrowT{y}{L}{\nat}{+}{e_2}}
       \end{math}
     \end{center}
     By the induction hypothesis we know 
     $\Gamma, [v/x]\Gamma',y:^L \nat \tvdash{L} 
     \arrowT{z}{L}{\nat}{+}{\arrowT{p}{L}{y=S\ z}{-}{[v/x][z/y]e_2}}:[[Type]]$ and
     $\Gamma,[v/x]\Gamma',y:^L \nat,
     f:^L \arrowT{z}{L}{\nat}{+}{\arrowT{p}{L}{y=S\ z}{-}{[v/x][z/y]e_2}} \tvdash{L} 
     [v/x]v':[v/x]e_2$.  Clearly, $f,p \not \in \mathsf{FV}([v/x]e_2)$.  Finally, by applying 
     $\FSdrulename{RecNat}$, 
     $\Gamma, [v/x]\Gamma' \tvdash{L} [v/x](\rec{f}{y}{v'}):[v/x](\arrowT{y}{L}{\nat}{+}{e_2})$.

   \item[Case.]\ \\
     \begin{center}
       \small
       \begin{math}
         $$\mprset{flushleft}
         \inferrule* [right=\FSdrulename{RecNatComp}] {
           \Gamma, x:^\theta e_2,\Gamma',y:^L \nat \tvdash{L} 
           \arrowT{z}{L}{\nat}{-}{\arrowT{p}{L}{y=S\ z}{-}{[z/y]e_2}}:[[Type]]
           \\\\
           \Gamma, x:^\theta e_2,\Gamma',y:^L \nat,
           f:^L \arrowT{z}{L}{\nat}{-}{\arrowT{p}{L}{y=S\ z}{-}{[z/y]e_2}} \tvdash{L}
           v':e_2
           \\\\
           f,p \not \in FV(e_2)
         }
         {\Gamma, x:^\theta e_2,\Gamma' \tvdash{L} \recc{f}{x}{v'}:\arrowT{y}{L}{\nat}{-}{e_2}}
       \end{math}
     \end{center}
     By the induction hypothesis we know 
     $\Gamma, [v/x]\Gamma',y:^L \nat \tvdash{L} 
     \arrowT{z}{L}{\nat}{-}{\arrowT{p}{L}{y=S\ z}{-}{[v/x][z/y]e_2}}:[[Type]]$ and
     $\Gamma, [v/x]\Gamma',y:^L \nat,
     f:^L \arrowT{z}{L}{\nat}{-}{\arrowT{p}{L}{y=S\ z}{-}{[v/x][z/y]e_2}} \tvdash{L}
     [v/x]v':[v/x]e_2$.  Now by applying $\FSdrulename{RecnatComp}$,
     $\Gamma, [v/x]\Gamma' \tvdash{L} [v/x](\recc{f}{x}{v'}):[v/x](\arrowT{y}{L}{\nat}{-}{e_2})$.
     
   % \item[Case.]\ \\
   %   \begin{center}
   %     \begin{math}
   %       $$\mprset{flushleft}
   %       \inferrule* [right=\FSdrulename{Rec}] {
   %         \Gamma, x:^\theta e_2,\Gamma' \tvdash{\theta''} e'_1:[[Type]]
   %         \\\\
   %        \Gamma, x:^\theta e_2,\Gamma',
   %        f:^{\theta'} \arrowT{z}{\theta''}{e'_1}{+}{e''_1},y:^{\theta''} e'_1 \tvdash{\theta'}
   %        e:e''_1
   %       }
   %       {\Gamma, x:^\theta e_2,\Gamma' \tvdash{P} 
   %         \rec{f}{y}{e}:\arrowT{y}{\theta''}{e'_1}{+}{e''_1}}
   %     \end{math}
   %   \end{center}
   %   Similar to the previous case.
  \end{itemize}
\end{proof}

Inversion says that if we know the conclusion of a typing rule is
true, then we know its premises.  The analysis in this section depends
on two inversion principles.  The first, is inversion for kinding, is
if we know $[[G |- e : Type th]]$, then we know the premises of the
kinding rules matching $[[e]]$, but this trivial result, and hence, we
do not state it here.  The second inversion principle is needed to
prove the case for \FSdrulename{AppPiTerm} in the proof of type
preservation.  This principle states that if we know that some
$\lambda$-abstractions type is a dependent product, then we know the
primise of the \FSdrulename{Lam} rule holds.

\begin{lemma}[Inversion]
  \label{lemma:inversion}
  If $\Gamma \tvdash{\theta'} \lambda x.e:\arrowT{x}{\theta}{e_1}{+}{e_2}$ 
  then 
  $\Gamma \tvdash{L} p:\arrowT{x}{\theta}{e_1}{+}{e_2} = \arrowT{x}{\theta}{a}{+}{b}$
  and
  $\Gamma,x:^\theta a \tvdash{\theta'} e:b$.
\end{lemma}
\begin{proof}
  We proceed by induction on the form of the assumed typing derivation.
  \begin{itemize}
  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Lam}] {
          \Gamma \tvdash{\theta} e_1:[[Type]]
          \\\\
          \Gamma,x:^{\theta} e_1 \tvdash{\theta'} e:e_2
        }{\Gamma \tvdash{\theta'} \lambda x.e:\arrowT{x}{\theta}{e_1}{+}{e_2}}
      \end{math}
    \end{center}
    By assumption, $\Gamma,x:^{\theta} e_1 \tvdash{\theta'} e:e_2$.  Clearly we can conclude
    $\Gamma \tvdash{L} p:(\arrowT{x}{\theta}{e_1}{+}{e_2}) = (\arrowT{x}{\theta}{e_1}{+}{e_2})$.
    
  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Conv}] {
          \Gamma \tvdash{\theta'} e':[e'_1/y]e'_2
          \\\\
          \Gamma \tvdash{L} e'':e'_1 = e''_1
        }{\Gamma \tvdash{\theta'} e':[e''_1/y]e'_2}
      \end{math}
    \end{center}
    Here $e' \equiv \lambda x.e$ and 
    $[e''_1/y]e'_2 \equiv \arrowT{x}{\theta}{[e''_1/y]r}{+}{[e''_1/y]s}$.  Clearly,
    $[e'_1/y]e'_2 \equiv \arrowT{x}{\theta}{[e'_1/y]r}{+}{[e'_1/y]s}$.  By the induction
    hypothesis, $\Gamma \tvdash{\theta'} e':[e'_1/y]e'_2$ implies 
    $\Gamma,x:^\theta a \tvdash{\theta'} e:b$ and 
    $\Gamma \tvdash{\theta'} $
    $p:(\arrowT{x}{\theta}{[e'_1/y]r}{+}{[e'_1/y]s}) = (\arrowT{x}{\theta}{a}{+}{b})$.  Finally, 
    since $\Gamma \tvdash{L} e'':e'_1 = e''_1$ we can apply $\FSdrulename{Conv}$ to obtain
    $\Gamma \tvdash{\theta'} $
    $p:(\arrowT{x}{\theta}{[e''_1/y]r}{+}{[e''_1/y]s}) = (\arrowT{x}{\theta}{a}{+}{b})$.
  \end{itemize}
\end{proof}
% section basic_results (end)

\section{Type Preservation}
\label{sec:type_preservation}
We are now in a position to prove type preservation.  The proof is
straightforward, and holds by induction on the typing derivation.
Type preservation is definately a result that should be proven for any
type theory or programming language being designed, implemented, or
studied.  This result insures that reduction does not wonder outside
the bounds of the type system.  If type preservation did not hold,
then one could start with a proof $[[e]]$ of some type, and then use
reduction to obtain that $[[e]]$ is a proof of some other type or that
$[[e]]$ is not a proof at all, or if one starts with the application
of some program to a series of arguments that is supposed to return a
natural number, but then after reduction ends up with some other type,
would result in reasoning about the correctness of the program
impossible!

It turned out that for freedom of speech logical consistency actually
depends on type preservation, which is quite unusual.  It is usually
the case that they are important, but distinct results.  In the next
section we will define an interpretation of types to prove weak
normalization.  Due to the collapsed nature of the freedom of speech
language these interpretations depend heavily on the typing
relation. It is this dependency that results in the proofs of the
critical properties of the interpretation of types to depend on type
preservation.  We conclude this section with the statement and proof
of type preservation.
 
\begin{thm}[Preservation]
  \label{thm:preservation}
  If $\Gamma \tvdash{\theta} e:e_1$ and $e \redto e'$ then $\Gamma \tvdash{\theta} e':e_1$.
\end{thm}
\begin{proof}
  We proceed by induction on the assumed typing derivation and only consider non-vacuous 
  cases.  We will implicitly assume $e \redto e'$ in each case.

  \begin{itemize}
  \item[Case.]\ \\
    \begin{center}
      $\FSdruleAppPiTerm{}$
    \end{center}
    We have two cases to consider either $e \redto e'$ or $e \equiv \lambda x.e'$
    and $e\ v \redto [v/x]e'$.  Consider the former, by the induction hypothesis, if 
    $e \redto e'$ then 
    $\Gamma \tvdash{L} e':\arrowT{x}{\theta}{e_1}{+}{e_2}$.  Now by applying the same
    rule, $\Gamma \tvdash{L} e'\ v:[v/x]e_2$.
    
    \noindent
    Now suppose the latter, by assumption we know $\Gamma \tvdash{\theta} v:e_1$ and
    $\Gamma \tvdash{L} \lambda x.e':\arrowT{x}{\theta}{e_1}{+}{e_2}$. By the Inversion Lemma, 
    $\Gamma,x:^\theta e_1 \tvdash{L} e':e_2$.  Thus, by Lemma~\ref{lemma:substitution},
    $\Gamma \tvdash{L}[v/x]e':[v/x]e_2$.

  \item[Case.]\ \\
    \begin{center}
      $\FSdruleAppAllTerm{}$
    \end{center}
    By the induction hypothesis, if $e \redto e'$ then 
    $\Gamma \tvdash{L} e':\arrowT{x}{\theta}{e_1}{-}{e_2}$.  Thus, by applying 
    $\FSdrulename{AppAllTerm}$, $\Gamma \tvdash{L} e':[v/x]e_2$.
    
  \item[Case.]\ \\
    \begin{center}
      $\FSdruleConv{}$
    \end{center}
    By the induction hypothesis, if $e \redto e''$ then $\Gamma \tvdash{\theta} e'':[e_1/x]e_2$.
    By applying $\FSdrulename{Conv}$, $\Gamma \tvdash{\theta} e'':[e'_1/x]e_2$.

  \item[Case.]\ \\
    \begin{center}
      $\FSdruleCoerce{}$
    \end{center}
    By the induction hypothesis, if $e \redto e'$ then $\Gamma \tvdash{L} e':e_1$ and by applying
    $\FSdrulename{Coerce}$, $\Gamma \tvdash{P} e':e_1$.
    
  \item[Case.]\ \\
    \begin{center}
      $\FSdruleRec{}$
    \end{center}
    By the induction hypothesis, if $e \redto e'$ then 
    $\Gamma, f:^\theta \arrowT{x}{\theta'}{e_1}{+}{e_2},x:^{\theta'} e_1 \tvdash{\theta} e':e_2$ 
    and by applying $\FSdrulename{Rec}$,
    $\Gamma \tvdash{P} \rec{f}{x}{e'}:\arrowT{x}{\theta'}{e_1}{+}{e_2}$.
  \end{itemize}
\end{proof}
% section type_preservation (end)

\section{Logical consistency}
\label{sec:logical_consistency}

One recurring statement throughout this thesis is that if we are to
consider a type theory or programming language, or even a fragment of
one as a logic, then that logic must be proven consistent.  We have to
believe what it is telling us is true!  If consistency has not been
shown, then neither the designer nor the programmer has the right to
consider any part of the language as containing proofs or formulas.
We have claimed that there is a logical fragment of freedom of speech,
thus we must show that this fragment is consistent.  The proof of
logical consistency is the topic of this section.

We prove logical consistency using reducibility candidates first
proposed by Girard.  For an overview of the reducibility method see
Section~\ref{sec:tait-griard_reduciblity}.  We begin with the
definition of the interpretation of types.

\begin{definition}
  \label{def:FS-interp}
  Let $J = \{e\ |\ e \join join \vee e \join injdom \vee e \join
  injran\}$ be the set of all the proofs of equations and $V$ be the
  set of terms such that $t \normto v$, where $v$ is a value.  We
  define the interpretation of types as follows:
  \begin{center}
    \begin{tabular}{lll}
      \begin{tabular}{lll}
        $e \in \interp{\nat}^{L}_\rho$ if and only if\\
        \begin{tabular}{lll}
          -- $[[. |- e:Nat L]]$ \\
          -- $e \in N = \{e'\ |\ e' \normto [[S]]^n\ [[Z]]\ where \ n \in \nat\}$\\
          \ \\
          \ \\
        \end{tabular}\\ 
      \end{tabular}
      &
      \begin{tabular}{lll}         
        $e \in \interp{[[(x : th e1) + -> e2]]}^{L}_\rho$ if and only if \\
        \begin{tabular}{lll}
          -- $[[. |- e : (x : th r e1) + -> r e2 L]]$ \\
          -- $[[. |- r ((x : th e1) + -> e2):Type th]]$ \\
          -- $e \in V$\\
          -- $\forall e' \in \interp{e_1}^{\theta}_{\rho} . e\ e' \in \interp{e_2}^L_{\rho[x \mapsto e']}$
        \end{tabular}
      \end{tabular}\\
      \\
      \begin{tabular}{lll}          
        $e \in \interp{\arrowT{x}{\theta}{e_1}{-}{e_2}}^{L}_\rho$ if and only if \\
        \begin{tabular}{lll}
          -- $[[. |- e : (x : th r e1) - -> r e2 L]]$ \\
          -- $[[.  |- r ((x : th e1) - -> e2):Type th]]$ \\ 
          -- $e \in V$ \\
          -- $\forall e' \in \interp{e_1}^{\theta}_{\rho} . e \in \interp{e_2}^L_{\rho[x \mapsto e']}$\\
        \end{tabular}                  
      \end{tabular}
      &
      \begin{tabular}{lll}
        $e \in \interp{e_1 = e_2}^{L}_\rho$ if and only if \\
        \begin{tabular}{lll}
          -- $\cdot \tvdash{L} e:\rho\ e_1 = \rho\ e_2$ \\
          -- $\cdot \tvdash{\theta} \rho\ (e_1 = e_2):[[Type]]$\\
          -- $e \in J$\\
          -- $\rho\ e_1 \join \rho\ e_2$\\
        \end{tabular}
      \end{tabular}\\
      \\
      \begin{tabular}{lll}          
        $e \in \interp{e'}^P_\rho$ if and only if \\
        \begin{tabular}{lll}
          -- $\cdot \tvdash{P} e:\rho\ e'$ \\
          -- $\cdot \tvdash{\theta} \rho\ e':[[Type]]$\\
          -- $e \in V$
        \end{tabular}
      \end{tabular}
    \end{tabular}
  \end{center}
\end{definition}
The interpretation of types consists of two parts, a deep
interpretation and a shallow one.  We give a deep interpretation of
the logical fragment where we characterize the termination behavior of
the programs, while we give a shallow interpretation of the programs
of the programmatic fragment.  The only property we can guarantee of
programmatic programs is that the terminating programs are well typed.
Note that the interpretation of types depend heavily on the typing
judgment, this is the dependency mentioned in the previous section on
type preservation.  Thus, the proofs of the critical properties
especially CR-Pres depend on type preservation.  Finally, the
interpretation of types depend on the notion of well-formed
substitutions which are defined in Figure~\ref{fig:fs-wf-subs}.

\begin{figure}[t]  
  \begin{center}
    \begin{tabular}{ccc}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [] {\ \\}{
          \emptyset \in \interp{\cdot}
        }
      \end{math}
       & & 
      \begin{math}
        $$\mprset{flushleft}
        \inferrule*[]{
          \Gamma \tvdash{L} e':[[Type]]
          \\
          \rho \in \interp{\Gamma}
          \\
          e \in \interp{e'}^L_\rho
        }{\rho \cup \{(x,e)\} \in \interp{\Gamma,x:^L e'}}
      \end{math}
      \\
      & & \\
      \begin{math}
        $$\mprset{flushleft}
        \inferrule*[]{
          \Gamma \tvdash{P} e':[[Type]]
          \\
          \rho \in \interp{\Gamma}
          \\
          v \in \interp{e'}^P_\rho
        }{\rho \cup \{(x,v)\} \in \interp{\Gamma,x:^P e'}}
      \end{math}
      & &\\
    \end{tabular}  
  \end{center}
  \caption{Well-formed substitutions}
  \label{fig:fs-wf-subs}
\end{figure}



\begin{lemma}[$\CRI$]
  \label{lemma:cri}
  If $t \in \interp{e}^\theta_\rho$ then $t$ is closed and $t \in V$.
\end{lemma}
\begin{proof}
  Trivial.
\end{proof}

\begin{lemma}[$\CRII$]
  \label{lemma:crii}
  If $t \in \interp{e}^\theta_\rho$ and $t \redto t'$ then $t' \in \interp{e}^\theta_\rho$
\end{lemma}
\begin{proof}
  This is a proof by structural induction on $e$.  By assumption we know 
  $\cdot \tvdash{\theta} \rho\ e:[[Type]]$, for each case below.  Hence, we assume this for
  the remainder of the proof.  In each of the function-type cases below we 
  assume $t \redto t'$, and $t' \in V$, because in each case $t \in V$.  We have two cases
  to consider when $\theta = L$ and when $\theta = P$.  The latter is trivial so we only
  consider the former.

  \begin{itemize}
  \item[Case.] Let $e \equiv \nat$.  
    Suppose $t \in \interp{\nat}^L_\rho$.  Then by the definition of the 
    interpretation of types, $t \in N$ and $t$ is closed.  Since CBV is deterministic,
    if $t \redto t'$ then $t' \in N$, and $t$ being closed implies $t'$ is closed.  At this
    point we still need show that $\cdot \tvdash{L} t':\nat$.  This easily follows from
    type preservation. Thus, $t' \in \interp{\nat}^L_\rho$.

  \item[Case.] Let $e \equiv (x :^\theta e_1)^+ \rightarrow e_2$.    
    Suppose $t \in \interp{e}^L_\rho$.  By the definition of the interpretation of types we know 
    for all $e' \in \interp{e_1}^\theta_\rho$, we have 
    $t\ e' \in \interp{e_2}^L_{\rho[x \mapsto e']}$.  
    Let $e'' \in \interp{e_1}^\theta_\rho$.  By the definition of left-to-right CBV, 
    $t\ e'' \redto t'\ e''$.  By the induction hypothesis, 
    $t'\ e'' \in \interp{e_2}^L_{\rho[x \mapsto e'']}$.  Now we need to show
    $\cdot \tvdash{L} t':(x :^\theta \rho\ e_1)^+ \rightarrow \rho\ e_2$.  This easly follows
    from type preservation.  Thus, by the definition 
    of the interpretation of types, $t' \in \interp{e}^L_{\rho}$, because $e''$ is arbitrary.
    
  \item[Case.] Let $e \equiv (x :^\theta e_1)^- \to e_2$.
    Suppose $t \in \interp{e}^L_\rho$.  By type preservation we know 
    $\cdot \tvdash{L} t':(x :^\theta \rho\ e_1)^- \to \rho\ e_2$.
    Let $u \in \interp{e_1}^\theta_\rho$. Then 
    $t \in \interp{e_2}^L_{\rho[x \mapsto u]}$.  By the induction hypothesis,
    $t' \in \interp{e_2}^L_{\rho[x \mapsto u]}$.  Thus, by the definition
    of the interpretation of types, $t' \in \interp{e}^L_\rho$.
      
  \item[Case.] Let $e \equiv e_1 = e_2$ and $t \in \interp{e}^L_\rho$.  
    By type preservation we know 
    $\cdot \tvdash{L} t':\rho\ e_1 = \rho\ e_2$.  By the definition of the 
    interpretation of types, $t \in V$, $\rho\ e_1 \join \rho\ e_2$, hence, 
    $t' \in V$, because $t \redto t'$.  Thus, again by the definition 
    of the interpretation of types, $t' \in \interp{e}^L_\rho$.    
  \end{itemize}
\end{proof}

\begin{lemma}[$\CRIII$]
  \label{lemma:criii}
  If $t \redto t'$, $\cdot \tvdash{L} t:\rho\ e$, and $t' \in \interp{e}^L_\rho$ 
  then $t \in \interp{e}^L_\rho$.
\end{lemma}
\begin{proof}
  This is a proof by structural induction on $e$.  
  By assumption we know $\cdot \tvdash{\theta} \rho\ e:[[Type]]$, for each case below.  Hence, we 
  assume this for the remainder of the proof.  In each of the cases below we assume
  $t \redto t'$, $t$ is closed, and $t' \in \interp{e}^L_\rho$ and in the function-type cases we 
  assume $t \in V$, because in each case $t' \in V$.  By assumption $t$ has the required type,
  thus we omit this assumption from the remainder of the proof.

  \begin{itemize}
  \item[Case.] Let $e \equiv \nat$.  
    By the definition of the interpretation of types we know
    $t' \in N$ and $t'$ is closed.  Now since CBV is deterministic and $t \redto t'$ we know
    $t \in N$.  Thus, $t \in \interp{\nat}^L_\rho$.

  \item[Case.] Let $e \equiv (x :^\theta e_1)^+ \rightarrow e_2$.    
    By the definition of the interpretation of types,
    for all $e' \in \interp{e_1}^\theta_\rho$, we have 
    $t'\ e' \in \interp{e_2}^L_{\rho[x \mapsto e']}$.
    Let $e'' \in \interp{e_1}^\theta_\rho$.  By the definition of left-to-right 
    CBV, $t\ e'' \redto t'\ e''$ and by the induction hypothesis, 
    $t\ e'' \in \interp{e_2}^L_{\rho[x \mapsto e'']}$.  By the definition of the interpretation of
    types, $t \in \interp{e}^L_{\rho}$.

  \item[Case.] Let $e \equiv (x :^\theta e_1)^- \to e_2$ and $u \in \interp{e_1}^\theta_\rho$.  
    Then $t' \in \interp{e_2}^L_{\rho[x \mapsto u]}$.  By the 
    induction hypothesis, $t \in \interp{e_2}^L_{\rho[x \mapsto u]}$, thus, by
    the definition of the interpretation of types, $t \in \interp{e}^L_\rho$.

  \item[Case.] Let $e \equiv e_1 = e_2$.
    By the definition of the interpretation of types, $t' \in V$,
    $\rho\ e_1 \join \rho\ e_2$, hence, $t \in V$, because 
    $t \redto t'$.  Therefore, 
    by the definition of the interpretation of types, $t \in \interp{e}^L_\rho$.
  \end{itemize}
\end{proof}

\begin{lemma}[Kinding conversion]
  \label{lemma:kinding_conversion}
  If $\Gamma \tvdash{\theta} [a/y]b:[[Type]]$ and $\Gamma \tvdash{L} p:a = a'$ then
  $\Gamma \tvdash{\theta} [a'/y]b:[[Type]]$.
\end{lemma}
\begin{proof}
  This is a proof by induction on the form of the assumed kinding derivation.
  \begin{itemize}
  \item[Case.] \ \\
    \begin{center}
      $\FSdruleKXXType{}$ 
    \end{center}
    Trivial.
    
  \item[Case.] \ \\
    \begin{center}
      $\FSdruleKXXNat{}$
    \end{center}
    Trivial.
    
  \item[Case.] \ \\
    \begin{center}
      $\FSdruleKXXPi{}$
    \end{center}
    We first consider when $\theta \equiv P$ and $b \equiv y$ where $y$ is a variable.  Then
    $[a/y]y \equiv \arrowT{x}{\theta'}{e_1}{\epsilon}{e_2}$ and 
    $a \equiv \arrowT{x}{\theta'}{e_1}{\epsilon}{e_2}$.  Clearly, if 
    $\Gamma \tvdash{P} [a/y]y:[[Type]]$ then $\Gamma, y:^P [[Type]] \tvdash{P} y:^P [[Type]]$.  By
    the substitution lemma, $\Gamma \tvdash{P} [a'/y]y:[[Type]]$.

    Now we consider when $\theta$ is arbitrary and 
    $b \equiv \arrowT{x}{\theta'}{r}{\epsilon}{s}$.
    Then $[a/y]b \equiv \arrowT{x}{\theta'}{[a/y]r}{\epsilon}{[a/y]s}$.  Here we can see that
    $e_1 \equiv [a/y]r$ and $e_2 \equiv [a/y]s$ so by the induction 
    hypothesis, $\Gamma \tvdash{\theta} [a'/y]r:[[Type]]$ and 
    $\Gamma, x:^{\theta'} [a/y]r \tvdash{\theta} [a'/y]s:[[Type]]$.  Finally, by applying 
    $\FSdrulename{K\_Pi}$, 
    $\Gamma \tvdash{\theta} \arrowT{x}{\theta'}{[a'/y]r}{\epsilon}{[a'/y]s}:[[Type]]$ which is 
    equivalent to 
    $\Gamma \tvdash{\theta} [a'/y](\arrowT{x}{\theta'}{r}{\epsilon}{s}):[[Type]]$.
  
  \item[Case.] \ \\
    \begin{center}
      $\FSdruleKXXEq{}$
    \end{center}
  \end{itemize}
  Since we are dealing with a stricly logical type $b$ cannot be a variable.  Hence, 
  $b \equiv r = s$, $[a/y]b \equiv [a/y]r = [a/y]s$, $e \equiv [a/y]r$ and $e' \equiv [a/y]s$.
  By assumption we know $\Gamma \tvdash{\theta_1} [a/y]r:e_1$ and 
  $\Gamma \tvdash{\theta_2} [a/y]s:e_2$.  Using $\FSdrulename{Conv}$ and 
  $\Gamma \tvdash{L} p:a = a'$ we obtain $\Gamma \tvdash{\theta_1} [a'/y]r:e_1$ and 
  $\Gamma \tvdash{\theta_2} [a'/y]s:e_2$.  Finally, by applying $\FSdrulename{K\_Eq}$,
  $\Gamma \tvdash{L} [a'/y]r = [a'/y]s:[[Type]]$.  Since $[a'/y]r = [a'/y]s \equiv 
  [a'/y](r = s) \equiv [a'/y]b$ we can conclude $\Gamma \tvdash{L} [a'/y]b:[[Type]]$.
\end{proof}

\begin{lemma}[Computational Semantic Conversion]
  \label{lemma:pconv_in_interp_are_equiv}
  If $e \join e'$ and $\Gamma \tvdash{\theta'} e:B$ and 
  $\Gamma \tvdash{\theta''} e':C$ then 
  $\interp{[e/x]A}^P_\rho \subseteq \interp{[e'/x]A}^P_\rho$.
\end{lemma}
\begin{proof}
  Let $\theta = P$.  We know that $a \in \interp{[e/x]A}^P_\rho$
  iff $\cdot \tvdash{P} a:\rho\ [e/x]A$ and $a\ is\ a\ value$ and $
  \cdot \tvdash{P} \rho\ [e/x]A:[[Type]]$ 
  by the definition of the interpretation of types.
  By $\FSdrulename{Join}$, $\Gamma \tvdash{L} join:e = e'$. Finally, by 
  $\FSdrulename{Conv}$, 
  $\cdot \tvdash{P} a:\rho\ [e'/x]A$.  Now by regularity $\cdot \tvdash{P} \rho\ [e'/x]A:[[Type]]$.
  Thus, $a \in \interp{[e'/x]A}^P_\rho$ and
  $\interp{[e/x]A}^P_\rho \subseteq \interp{[e'/x]A}^P_\rho$.
\end{proof}

\begin{lemma}[Logical Semantic Conversion]
  \label{lemma:lconv_in_interp_are_equiv}
  If $e \join e'$ and $\Gamma \tvdash{\theta'} e:B$ and $\Gamma \tvdash{\theta''} e':C$ then 
  $\interp{[e/x]A}^L_\rho \subseteq \interp{[e'/x]A}^L_\rho$.
\end{lemma}
\begin{proof}
  We proceed by induction on the form of $A$.  In each case we must show 
  $\cdot \tvdash{L} a:\rho[e'/x]A$ and $\cdot \tvdash{L} \rho[e'/x]A:[[Type]]$.  The former is easly 
  accomplished by first applying $\FSdrulename{Join}$ to obtain $\cdot \tvdash{L} join:e = e'$ 
  and then applying $\FSdrulename{Conv}$ to obtain the desired result.  The latter is obtained
  by regularity.
  
  \begin{itemize}
  \item[Case.] Let $A \equiv \nat$.  Obvious.
    
  \item[Case.] Let $A \equiv \arrowT{x}{\theta}{a_1}{+}{a_2}$, $\rho$ be an arbitrary 
    substitution and $a \in \interp{[e/x]A}^L_\rho$.  By the definition of the interpretations 
    of types,
    $a \in \interp{[e/x]A}^L_\rho$ iff for any 
    $a' \in \interp{[e/x]a_1}^\theta_\rho$ we have
    $a\ a' \in \interp{[e/x]a_2}^L_{\rho[x \mapsto a']}$.
    Let $a''$ be an arbitrary element of $\interp{[e/x]a_1}^\theta_\rho$. We have two cases
    to consider when $\theta = L$ and $\theta = P$.  If $\theta = L$ then by the induction 
    hypothesis, 
    $\interp{[e/x]a_1}^L_\rho = \interp{[e'/x]a_1}^L_\rho$.  
    If $\theta = P$ then we apply  
    Lemma~\ref{lemma:pconv_in_interp_are_equiv} to obtain 
    $\interp{[e/x]a_1}^P_\rho = \interp{[e'/x]a_1}^P_\rho$.
    Also by the induction hypothesis,
    $\interp{[e/x]a_2}^L_{\rho[x \mapsto a'']} = \interp{[e'/x]a_2}^L_{\rho[x \mapsto a'']}$.  
    Thus, 
    $a'' \in \interp{[e'/x]a_1}^\theta_\rho$ and
    $a\ a'' \in \interp{[e'/x]a_2}^L_{\rho[x \mapsto a'']}$ for arbitrary $a''$, hence,
    by the definition of the interpretations of types,
    $a \in \interp{[e'/x]A}^L_\rho$.  Therefore, 
    $\interp{[e/x]A}^L_\rho \subseteq \interp{[e'/x]A}^L_\rho$.
    
  \item[Case.]  Let $A \equiv \arrowT{x}{\theta}{e_1}{-}{e_2}$.  Similar to the previous case.
    
  \item[Case.] Let $A \equiv a_1 = a_2$, $\rho$ be an arbitrary 
    substitution and $a \in \interp{[e/x]A}^L_\rho$.
    By the definition of the interpretations of types,
    $a \in \interp{[e/x]A}^L_\rho$ iff $a \in V$ and 
    $\rho[e/x]a_1 \join \rho[e/x]a_2$.
    Clearly, if $e \join e'$ and $\rho[e/x]a_1 \join \rho[e/x]a_2$ then 
    $\rho['e/x]a_1 \join \rho['e/x]a_2$.
    Thus, $a \in \interp{[e'/x]A}^L_\rho$.  Therefore,
    $\interp{[e/x]A}^L_\rho \subseteq \interp{[e'/x]A}^L_\rho$.
  \end{itemize}
\end{proof}

\begin{lemma}[Substitution Distribution]
  \label{lemma:movable_subs}
  $\interp{e}^\theta_{\rho[x \mapsto e']} = \interp{[e'/x]e}^\theta_\rho$
\end{lemma}
\begin{proof}
  This is a proof by induction on the form of $e$.  We first consider when $\theta = L$ and
  then when $\theta = P$.  Note that we do not show both directions of the equality.  We only
  prove left to right the other direction is similar.
  
  \begin{itemize}
  \item[Case.] Let $e \equiv \nat$.  
    Since $\rho\ \nat = \nat$ for any substitution $\rho$, clearly
    $\interp{e}^L_{\rho[x \mapsto e']} = \interp{[e'/x]e}^L_\rho$.

  \item[Case.] Let $e \equiv \arrowT{y}{\theta}{e_1}{+}{e_2}$.  Suppose 
    $a \in \interp{e}^\theta_{\rho[x \mapsto e']}$.  Then by the interpretations of types,
    $\cdot \tvdash{\theta} a:
    \arrowT{y}{\theta}{\rho[x \mapsto e']\ e_1}{+}{(\rho[x \mapsto e']\ e_2)}$, 
    $a \in V$,
    and for any $a' \in \interp{e_1}^L_{\rho[x \mapsto e']}$ we have 
    $a\ a' \in \interp{e_2}^L_{\rho[x \mapsto e'][y \mapsto a']}$.  Clearly, 
    $\rho[x \mapsto e'][y \mapsto a']$ is equivalent to
    $\rho[y \mapsto [e'/x]a'][x \mapsto e']$, thus, 
    $a\ a' \in \interp{e_2}^L_{\rho[y \mapsto [e'/x]a'][x \mapsto e']}$.  Now by the induction
    hypothesis, $\interp{e_1}^L_{\rho[x \mapsto e']} = \interp{[e'/x]e_1}^L_{\rho}$ and
    $\interp{e_2}^L_{\rho[y \mapsto [e'/x]a'][x \mapsto e']} = 
    \interp{[e'/x]e_2}^L_{\rho[y \mapsto [e'/x]a']}$.  Therefore, by the definition of the 
    interpretation of types, $\interp{e}^L_{\rho[x \mapsto e']} \subseteq \interp{[e'/x]e}^L_\rho$.

  \item[Case.]  Let $e \equiv \arrowT{y}{\theta}{e_1}{-}{e_2}$.  Similar to the previous case.

  \item[Case.] Let $e \equiv e_1 = e_2$.  Suppose $a \in \interp{e}^\theta_{\rho[x \mapsto e']}$.
    By the definition of the interpretation of types, 
    $\cdot \tvdash{L} a:\rho[x \mapsto e']\ e_1 = \rho[x \mapsto e']\ e_2$, 
    $\cdot \tvdash{L} \rho[x \mapsto e']\ e_1 = \rho[x \mapsto e']\ e_2:[[Type]]$,
    $a \in V$, 
    and $\rho[x \mapsto e']\ e_1 \join \rho[x \mapsto e']\ e_2$.  Clearly, if 
    $\cdot \tvdash{L} a:\rho[x \mapsto e']\ e_1 = \rho[x \mapsto e']\ e_2$ then
    $\cdot \tvdash{L} a:\rho\ [e'/x]e_1 = \rho\ [e'/x]e_2$, the same applies to the kinding
    judgment and
    if $\rho[x \mapsto e']\ e_1 \join \rho[x \mapsto e']\ e_2$ then
    $\rho\ [e'/x]e_1 \join \rho\ [e'/x]e_2$.  Therefore, by the definition of the 
    interpretation of types, 
    $\interp{e}^L_{\rho[x \mapsto e']} \subseteq \interp{[e'/x]e}^L_\rho$.
  \end{itemize}
  
  Now assume $\theta = P$.
  \begin{itemize}
  \item[Case.] Assume $a \in \interp{e}^P_{\rho[x \mapsto e']}$.  By the definition of the 
    interpretation of types, $\cdot \tvdash{P} a:\rho[x \mapsto e']\ e$,
    $\cdot \tvdash{P} \rho[x \mapsto e']\ e:[[Type]]$ and $a$ is a value.
    Just as in the previous case if $\cdot \tvdash{P} a:\rho[x \mapsto e']\ e$ and
    $\cdot \tvdash{P} \rho[x \mapsto e']\ e:[[Type]]$ then
    $\cdot \tvdash{P} a:\rho\ [e'/x]e$ and $\cdot \tvdash{P} \rho\ [e'/x]e:[[Type]]$.  Therefore, by 
    the definition of the interpretation of
    types, $\interp{e}^L_{\rho[x \mapsto e']} \subseteq \interp{[e'/x]e}^L_\rho$.
  \end{itemize}
\end{proof}

\begin{lemma}[Substitution for kinding and typing]
  \label{lemma:substitution_kinding_typing}
  \begin{itemize}
  \item[]
  \item[i.]   If $\rho \in \interp{\Gamma}$ and $\Gamma \tvdash{\theta} e:[[Type]]$ then 
    $\cdot \tvdash{\theta} \rho\ e:[[Type]]$.
  \item[ii.]   If $\rho \in \interp{\Gamma}$ and $\Gamma \tvdash{\theta} v:e$ then 
    $\cdot \tvdash{\theta} \rho\ v:\rho\ e$.
  \end{itemize}

\end{lemma}
\begin{proof}
  This is a proof by induction on the form of the assumped typing judgment.  We first prove
  part i.
  \begin{itemize}
  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=$K\_[[Type]]$ ] {
          \ 
        }{\Gamma \tvdash{P} [[Type]]:[[Type]]}
      \end{math}
    \end{center}
    Trivial.
    
    \item[Case.]\ \\
      \begin{center}
        \begin{math}
          $$\mprset{flushleft}
          \inferrule* [right=K\_Nat] {
            \ 
          }{\Gamma \tvdash{L} \nat:[[Type]]}
        \end{math}
      \end{center}
      Trivial.
      
    \item[Case.]\ \\
      \begin{center}
        \begin{math}
          $$\mprset{flushleft}
          \inferrule* [right=K\_Pi] {
            \Gamma \tvdash{\theta'} e_1:[[Type]]
            \\\\
            \Gamma,x:^{\theta'} e_1 \tvdash{\theta} e_2:[[Type]]
          }{\Gamma \tvdash{\theta} \arrowT{x}{\theta'}{e_1}{\epsilon}{e_2}:[[Type]]}
        \end{math}
      \end{center}
      By part one of the induction hypothesis, $\cdot \tvdash{\theta'} \rho\ e_1:[[Type]]$ and
      $\cdot,x:^{\theta'} \rho\ e_1 \tvdash{\theta} \rho\ e_2:[[Type]]$.  Thus, by applying 
      $\FSdrulename{K\_Pi}$ 
      $\cdot \tvdash{\theta} \arrowT{x}{\theta'}{\rho\ e_1}{\epsilon}{\rho\ e_2}:[[Type]]$, which
      is equivalent to 
      $\cdot \tvdash{\theta} \rho\ (\arrowT{x}{\theta'}{e_1}{\epsilon}{e_2}):[[Type]]$.
      
    \item[Case.]\ \\
      \begin{center}
        \begin{math}
          $$\mprset{flushleft}
          \inferrule* [right=K\_Eq] {
            \Gamma \tvdash{\theta_1} e:e_1
            \\\\
            \Gamma \tvdash{\theta_2} e':e_2
          }{\Gamma \tvdash{L} e = e':[[Type]]}
        \end{math}
      \end{center}
      By part two of the induction hypothesis, $\cdot \tvdash{\theta_1} \rho\ e:\rho e_1$ and
      $\cdot \tvdash{\theta_2} \rho\ e':\rho\ e_2$.  Thus, by applying $\FSdrulename{K\_Eq}$
      $\cdot \tvdash{L} \rho\ e = \rho\ e':[[Type]]$, which is equivalent to
      $\cdot \tvdash{L} \rho\ (e = e'):[[Type]]$.
  \end{itemize}
  
  We now prove part ii.
  \begin{itemize}
  \item[Case.] \ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Var}]{
          \Gamma \tvdash{\theta} e:[[Type]]
          \\\\
          x:^{\theta} e \in \Gamma
        }{\Gamma \tvdash{\theta} x:^{\theta} e}
      \end{math}
    \end{center}
    By part one of the induction hypothesis, $\cdot \tvdash{\theta} \rho\ e:[[Type]]$.  Since
    $x:^{\theta} e \in \Gamma$ then there exists a $x \mapsto e' \in \rho$ such that 
    $e' \in \interp{e}^\theta_\rho$.  By the definition of the interpretation of types
    $\cdot \tvdash{\theta} e':\rho\ e$, which is equivalent to 
    $\cdot \tvdash{\theta} \rho\ x:^{P} \rho\ e$.
    

  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Lam}] {
          \Gamma \tvdash{\theta} e_1:[[Type]]
          \\\\
          \Gamma,x:^{\theta} e_1 \tvdash{\theta'} e:e_2
        }{\Gamma \tvdash{\theta'} 
          \lambda x.e:\arrowT{x}{\theta}{e_1}{+}{e_2}}
      \end{math}
    \end{center}
    By part one of the induction hypothesis, $\cdot \tvdash{\theta} \rho\ e_1:[[Type]]$ and
    by part two, $\cdot,x:^{\theta} \rho\ e_1 \tvdash{\theta'} \rho\ e:\rho\ e_2$.  Thus, by
    applying $\FSdrulename{Lam}$ 
    $\cdot \tvdash{\theta'} \lambda x.\rho\ e:\arrowT{x}{\theta}{\rho\ e_1}{+}{\rho\ e_2}$, which
    is equivalent to 
    $\cdot \tvdash{\theta'} \rho\ (\lambda x.e):\rho\ (\arrowT{x}{\theta}{e_1}{+}{e_2})$.

  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{ILam}] {
          \Gamma \tvdash{\theta} e_1:[[Type]]
          \\\\
          \Gamma,x:^{\theta} e_1 \tvdash{\theta'} v:e_2
          \\\\
          x \not \in fvs(v)
        }{\Gamma \tvdash{\theta'} 
          v:\arrowT{x}{\theta}{e_1}{-}{e_2}}
      \end{math}
    \end{center}
    Similar to the previous case.

  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule*[right=\FSdrulename{AppAllTerm}]{
          \Gamma \tvdash{\theta'} v:\arrowT{x}{\theta}{e_1}{-}{e_2}
          \\\\
          \Gamma \tvdash{\theta} v':e_1
        }{\Gamma \tvdash{\theta'} v:[v'/x]e_2}
      \end{math}
    \end{center}
    By part two of the induction hypothesis, 
    $\cdot \tvdash{\theta'} \rho\ v:\rho\ (\arrowT{x}{\theta}{e_1}{-}{e_2})$ and
    $\cdot \tvdash{\theta} \rho\ v':\rho\ e_1$.  Thus, by applying $\FSdrulename{AppAllTerm}$
    $\cdot \tvdash{\theta'} \rho\ v:[\rho\ v'/x]\rho\ e_2$, which is equivalent to
    $\cdot \tvdash{\theta'} \rho\ v:\rho\ ([v'/x]e_2)$.

  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Join}] {
          e \join e'
          \\\\
          \Gamma \tvdash{\theta_1} e:e_1
          \\\\
          \Gamma \tvdash{\theta_2} e':e_2
        }{\Gamma \tvdash{L} join : e = e'}
      \end{math}
    \end{center}
    It is a property of compatible joinablity that if $e \join e'$ then
    $\rho\ e \join \rho\ e'$.  By part two of the induction hypothesis,
    $\cdot \tvdash{\theta_1} \rho\ e:\rho\ e_1$ and $\cdot \tvdash{\theta_1} \rho\ e:\rho\ e_1$.
    Hence, by applying $\FSdrulename{Join}$ $\cdot \tvdash{L} join : \rho\ e = \rho\ e'$, which 
    is equivalent to $\cdot \tvdash{L} join : \rho\ (e = e')$.

  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{InjDom}] {
          \Gamma \tvdash{L} e':(\arrowT{x}{\theta}{e_1}{+}{e_2}) = 
          (\arrowT{x}{\theta}{e'_1}{+}{e'_2})
        }{\Gamma \tvdash{L} injdom : e_1 = e'_1}
      \end{math}
    \end{center}
    By part two of the induction hypothesis, 
    $\cdot \tvdash{L} \rho\ e':\rho\ ((\arrowT{x}{\theta}{e_1}{+}{e_2}) = 
    (\arrowT{x}{\theta}{e'_1}{+}{e'_2}))$ and by applying $\FSdrulename{InjDom}$
    $\cdot \tvdash{L} \rho\ injdom : \rho\ e_1 = \rho\ e'_1$, which is equivalent to
    $\cdot \tvdash{L} \rho\ injdom : \rho\ (e_1 = e'_1)$.
    
  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{InjRan}] {
          \Gamma \tvdash{L} e':(\arrowT{x}{\theta}{e_1}{+}{e_2}) = 
          (\arrowT{x}{\theta}{e'_1}{+}{e'_2})
          \\\\
          \Gamma \tvdash{\theta} v:e_1
        }{\Gamma \tvdash{L} injran : [v/x]e_2 = [v/x]e'_2}
        \end{math}
    \end{center}
    Similar to the previous case.

  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Conv}] {
          \Gamma \tvdash{\theta} v:[e_1/x]e_2
          \\\\
          \Gamma \tvdash{L} e':e_1 = e'_1
        }{\Gamma \tvdash{\theta} v:[e'_1/x]e_2}
      \end{math}
    \end{center}
    By part two of the induction hypothesis, 
    $\cdot \tvdash{\theta} \rho\ v:[\rho\ e_1/x]\rho\ e_2$ and 
    $\cdot \tvdash{L} \rho\ e':\rho\ e_1 = \rho\ e'_1$. Hence, by applying
    $\FSdrulename{Conv}$ $\cdot \tvdash{\theta} \rho\ v:[\rho\ e'_1/x]\rho\ e_2$, which
    is equivalent to $\cdot \tvdash{\theta} \rho\ v:\rho\ ([e'_1/x]e_2)$.

  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Zero}] {
          \ 
        }{\Gamma \tvdash{L} Z:\nat}
      \end{math}
    \end{center}
    Tivial.

  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Coerce}] {
          \Gamma \tvdash{L} v:e_1
        }{\Gamma \tvdash{P} v:e_1}
      \end{math}
    \end{center}
    By part two of the induction hypothesis, $\cdot \tvdash{L} \rho\ v:\rho\ e_1$ and by applying
    $\FSdrulename{Coerce}$ $\cdot \tvdash{P} \rho\ v:\rho\ e_1$.

  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{RecNat}] {
          \Gamma,x:^L \nat \tvdash{L} 
          \arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x=S\ y}{-}{[y/x]e_2}}:[[Type]]
          \\\\
          \Gamma, x:^L \nat,
          f:^L \arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x=S\ y}{-}{[y/x]e_2}} \tvdash{L}
          v:e_2
          \\\\
          f,p \not \in FV(e_2)
        }
        {\Gamma \tvdash{L} \rec{f}{x}{v}:\arrowT{x}{L}{\nat}{+}{e_2}}
      \end{math}
    \end{center}
    By part one of the induction hypothesis, 
    $\cdot,x:^L \nat \tvdash{L} 
    \rho\ (\arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x=S\ y}{-}{[y/x]e_2}}):[[Type]]$ and by part two
    $\cdot, x:^L \nat,
    f:^L \rho\ (\arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x=S\ y}{-}{[y/x]e_2}}) \tvdash{L}
    \rho\ v:\rho\ e_2$.  Now by applying $\FSdrulename{RecNat}$,
    $\cdot \tvdash{L} \rec{f}{x}{\rho\ v}:\arrowT{x}{L}{\nat}{+}{\rho\ e_2}$ which is equivalent 
    to $\cdot \tvdash{L} \rho\ (\rec{f}{x}{v}):\rho\ (\arrowT{x}{L}{\nat}{+}{e_2})$.

  \item[Case.] \ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{RecNatComp}] {
          \Gamma,x:^L \nat \tvdash{L} 
          \arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x=S\ y}{-}{[y/x]e_2}}:[[Type]]
          \\\\
          \Gamma,x:^L \nat,
          f:^L \arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x=S\ y}{-}{[y/x]e_2}} \tvdash{L} v:e_2
          \\\\
          f,p \not \in FV(e_2)
        }
        {\Gamma \tvdash{L} \recc{f}{x}{v}:\arrowT{x}{L}{\nat}{-}{e_2}}
      \end{math}
    \end{center}
    Similar to the previous case.
    
  \item[Case.]\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Rec}] {
          \Gamma \tvdash{\theta'} e_1:[[Type]]
          \\\\
          \Gamma, f:^{\theta} \arrowT{x}{\theta'}{e_1}{+}{e_2},x:^{\theta'} e_1 \tvdash{\theta}
          e:e_2
        }
        {\Gamma \tvdash{P} \rec{f}{x}{e}:\arrowT{x}{\theta'}{e_1}{+}{e_2}}
      \end{math}
    \end{center}
    By part one of the induction hypothesis, $\cdot \tvdash{\theta'} \rho\ e_1:[[Type]]$ and by 
    part two,
    $\cdot, f:^{\theta} \rho\ (\arrowT{x}{\theta'}{e_1}{+}{e_2}),x:^{\theta'} \rho\ e_1 
    \tvdash{\theta} \rho\ e:\rho\ e_2$.  Thus, by applying $\FSdrulename{Rec}$
    $\cdot \tvdash{P} \rec{f}{x}{\rho\ e}:\arrowT{x}{\theta'}{\rho\ e_1}{+}{\rho\ e_2}$, which
    is equivalent to 
    $\cdot \tvdash{P} \rho\ (\rec{f}{x}{e}):\rho\ (\arrowT{x}{\theta'}{e_1}{+}{e_2})$.
  \end{itemize}
\end{proof}

\begin{thm}[Type soundness]
  \label{thm:type_soundness}
  If $\Gamma \tvdash{L} e:e'$ then for all 
  $\rho \in \interp{\Gamma}, \rho\ e \in \interp{e'}^L_\rho$.
\end{thm}
\begin{proof}
  Throughout this proof we implicitly assume an arbitrary $\rho \in \interp{\Gamma}$ and
  that $\cdot \tvdash{L} \rho\ e':[[Type]]$.  The latter holds by first applying regularity to obtain
  $\Gamma \tvdash{L} e:[[Type]]$ and then applying Lemma~\ref{lemma:substitution_kinding_typing} to
  obtain $\cdot \tvdash{L}\rho\ e:[[Type]]$.
  
  \begin{itemize}
  \item[]\ \\
    
  \item[]Case.\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Var}]{
          \Gamma \tvdash{L} e:[[Type]]
          \\\\
          x:^{L} e \in \Gamma
        }{\Gamma \tvdash{L} x:^{L} e}
      \end{math}
    \end{center}
    By definition of $\interp{\Gamma}$ we know there exists some $e'$
    such that $(x,e') \in \rho$ and $e' \in \interp{e}^L_\rho$.
    Now $\rho\ x \equiv e' \in \interp{e}^L_\rho$.
    
  \item[]Case.\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Lam}] {
          \Gamma \tvdash{\theta} e_1:[[Type]]
          \\\\
          \Gamma,x:^\theta e_1 \tvdash{L} e:e_2
        }{\Gamma \tvdash{L} \lambda x.e:\arrowT{x}{\theta}{e_1}{+}{e_2}}
      \end{math}
    \end{center}
    We need to show 
    $\rho\ \lambda x.e \equiv \lambda x.(\rho\ e) \in $
    $\interp{\arrowT{x}{\theta}{e_1}{+}{e_2}}^{L}_\rho$.  So by the
    definition of the interpretation of types, we must show for any
    $e' \in \interp{e_1}^\theta_\rho$, $(\rho\ e)\ e' \in
    \interp{e_2}^{L}_{\rho[x \mapsto e']}$.  Let $e' \in \interp{e_1}^\theta_\rho$. 
    By CR-Norm, $e'$ is closed and $e' \in V$, hence, $e' \normto v$ and
    by CR-Pres, $v \in \interp{e_1}^\theta_{\rho}$.  By the definition of the
    left-to-right CBV, $(\lambda x.(\rho\ e))\ e' \redto^* (\lambda x.(\rho\ e))\ v $
    $\redto \rho[v/x]\ e$.  We
    know $v \in \interp{e_1}^\theta_\rho$ and $\rho \in
    \interp{\Gamma}$, hence, by the definition of well-formed
    substitutions, $\rho[v/x] \in \interp{\Gamma,x:^\theta e_1}$.  We can now apply the
    induction hypothesis to obtain, $\rho[v/x]e \in
    \interp{e_2}^L_{\rho[x \mapsto v]}$. It is easy to see that $(\lambda
    x.(\rho\ e))\ e'$ is closed so we can apply CR-Pres and
    obtain $(\lambda x.(\rho\ e))\ e' \in
    \interp{e_2}^L_{\rho[x \mapsto v]}$.  By 
    Lemma~\ref{lemma:lconv_in_interp_are_equiv} and Lemma~\ref{lemma:movable_subs},
    $\interp{e_2}^L_{\rho[x \mapsto v]} = \interp{e_2}^L_{\rho[x \mapsto e']}$.
    Thus, by the definition of the
    interpretation of types, $\lambda x.(\rho\ e) \in
    \interp{\arrowT{x}{\theta}{e_1}{+}{e_2}}^{L}_\rho$.

  \item[]Case.\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{ILam}] {
          \Gamma \tvdash{\theta} e_1:[[Type]]
          \\\\
          \Gamma,x:^\theta e_1 \tvdash{L} v:e_2
          \\\\
          x \not \in fvs(v)
        }{\Gamma \tvdash{L} v:\arrowT{x}{\theta}{e_1}{-}{e_2}}
      \end{math}
    \end{center}
    We need to show 
    $\rho\ v \in \interp{\arrowT{x}{\theta}{e_1}{-}{e_2}}^{L}_\rho$.  So by the
    definition of the interpretation of types, we must show for any
    $e' \in \interp{e_1}^\theta_\rho$, $\rho\ v \in
    \interp{e_2}^{L}_{\rho[x \mapsto e']}$.  Let $e' \in
    \interp{e_1}^\theta_\rho$.  By CR-Norm, $e'$ is closed and $e' \in V$,
    hence, $e' \normto v'$ and by CR-Pres $v' \in \interp{e_1}^\theta_\rho$.
    By the definition of the left-to-right CBV, 
    $(\rho\ v)\ e' \redto^* (\rho\ v)\ v' \redto \rho[v'/x]\ v \equiv \rho\ v$.  We
    know $v' \in \interp{e_1}^\theta_\rho$ and $\rho \in
    \interp{\Gamma}$, hence, by the definition of well-formed
    substitutions, $\rho[v'/x] \in \interp{\Gamma,x:^\theta e_1}$.  Thus, 
    we can now apply the induction hypothesis to obtain, $\rho\ v \in
    \interp{e_2}^L_{\rho[x \mapsto v']}$. By 
    Lemma~\ref{lemma:lconv_in_interp_are_equiv} and Lemma~\ref{lemma:movable_subs} 
    $\interp{e_2}^L_{\rho[x \mapsto v']} = \interp{e_2}^L_{\rho[x \mapsto e']}$.  
    Thus, by the definition of the interpretation of types, $\rho\ v \in
    \interp{\arrowT{x}{\theta}{e_1}{-}{e_2}}^{L}_\rho$.

  \item[]Case.\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule*[right=\FSdrulename{AppPiTerm}]{
          \Gamma \tvdash{L} e:\arrowT{x}{\theta}{e_1}{+}{e_2}
          \\\\
          \Gamma \tvdash{\theta} v:e_1
        }{\Gamma \tvdash{L} e\ v:[v/x]e_2}
      \end{math}
    \end{center}


    By the induction hypothesis, $\rho\ e \in
    \interp{\arrowT{x}{\theta}{e_1}{+}{e_2}}^L_\rho$.  If $\theta = L$ then
    by the induction hypothesis, $\rho\ v \in \interp{e_1}^\theta_\rho$.  If $\theta = P$ then
    by Lemma~\ref{lemma:substitution_kinding_typing}, $\cdot \tvdash{P} \rho\ v:e_1$, and by the
    definition of the interpretation of types, $\rho\ v \in \interp{e_1}^\theta_\rho$.
    Now we know by the 
    definition of the
    interpretation of types that for any $v' \in
    \interp{e_1}^\theta_\rho$, $(\rho\ e)\ v' \in $
    $\interp{e_2}^L_{\rho[x \mapsto v']}$.  Instantiate $v'$ with $\rho\ v$. 
    Then $(\rho\ e)\ \rho\ v$ $\equiv \rho(e\ v) \in
    \interp{e_2}^L_{\rho[x \mapsto \rho\ v]}$.
    
  \item[]Case.\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule*[right=\FSdrulename{AppAllTerm}]{
          \Gamma \tvdash{L} e:\arrowT{x}{\theta}{e_1}{-}{e_2}
          \\\\
          \Gamma \tvdash{\theta} v:e_1
        }{\Gamma \tvdash{L} e:[v/y]e_2}
      \end{math}
    \end{center}

    By the induction hypothesis, $\rho\ e \in
    \interp{\arrowT{x}{\theta}{e_1}{-}{e_2}}^L_\rho$.  If $\theta = L$ then
    by the induction hypothesis, $\rho\ v \in \interp{e_1}^\theta_\rho$.  If
    $\theta = P$ then by Lemma~\ref{lemma:substitution_kinding_typing},
    $\cdot \tvdash{P} \rho\ v:\rho\ e_1$, thus, by the definition of the interpretation
    of types, $\rho\ v \in \interp{e_1}^\theta_\rho$.
    We know by the definition of the
    interpretation of types that for any $v' \in
    \interp{e_1}^\theta_\rho$, $\rho\ e \in $
    $\interp{e_2}^L_{\rho[x \mapsto v']}$.  Instantiate $v'$ with $\rho\ v$. 
    Then $\rho\ e \in \interp{e_2}^L_{\rho[x \mapsto \rho\ v]}$.
  
  \item[]Case.\ \\
    \begin{center}
      $\FSdrulejoin{}$
    \end{center}  
    It is a property of left-to-right CBV that
    if $e \join e'$ then $\rho\ e \join \rho\ e'$ for any substitution $\rho$.
    By Lemma~\ref{lemma:substitution_kinding_typing}, 
    $\cdot \tvdash{L} join : \rho\ e = \rho\ e'$.
    Hence by the definition of the interpretation of types, $join \in \interp{e = e'}^L_\rho$.

  \item[] Case.\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{InjDom}] {
          \Gamma \tvdash{L} e':(\arrowT{x}{\theta}{e_1}{+}{e_2}) = 
          (\arrowT{x}{\theta}{e'_1}{+}{e'_2})
        }{\Gamma \tvdash{L} injdom : e_1 = e'_1}
      \end{math}
    \end{center}
    By the induction hypothesis, 
    $e' \in \interp{(\arrowT{x}{\theta}{e_1}{+}{e_2}) = 
      (\arrowT{x}{\theta}{e'_1}{+}{e'_2})}^L_\rho$, which implies that 
    $\rho\ e_1 \join \rho\ e'_1$.  By Lemma~\ref{lemma:substitution_kinding_typing},
    $\cdot \tvdash{L} injdom : \rho\ e_1 = \rho\ e'_1$.  Therefore by the definition of the
    interpretation of types, $injdom \in \interp{e_1 = e'_1}^L_\rho$.

  \item[] Case.\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{InjRan}] {
          \Gamma \tvdash{L} e':(\arrowT{x}{\theta}{e_1}{+}{e_2}) = 
          (\arrowT{x}{\theta}{e'_1}{+}{e'_2})
          \\\\
          \Gamma \tvdash{\theta} v:e_1
        }{\Gamma \tvdash{L} injran : [v/x]e_2 = [v/x]e'_2}
      \end{math}
    \end{center}
    By the induction hypothesis, 
    $e' \in \interp{(\arrowT{x}{\theta}{e_1}{+}{e_2}) = 
      (\arrowT{x}{\theta}{e'_1}{+}{e'_2})}^L_\rho$, which implies that 
    $\rho\ e_2 \join \rho\ e'_2$.  Since compatibility joinablity is closed under substitution,
    $\rho\ [v/x]e_2 \join \rho\ [v/x]e'_2$, we can move $\rho$ to the outside, because $x$ is
    not a member of the domain of $\rho$. By Lemma~\ref{lemma:substitution_kinding_typing},
    $\cdot \tvdash{L} injran : \rho\ [v/x]e_2 = \rho\ [v/x]e'_2$.  Therefore by the definition of
    theinterpretation of types, $injran \in \interp{[v/x]e_2 = [v/x]e'_2}^L_\rho$.

  \item[]Case.\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{Conv}] {
          \Gamma \tvdash{L} e:[e_1/x]e_2
          \\\\
          \Gamma \tvdash{L} e':e_1 = e'_1
        }{\Gamma \tvdash{L} e:[e'_1/x]e_2}
      \end{math}

    \end{center}
    $\Gamma \tvdash{L} e':e_1 = e'_1$ implies $e_1 \join e'_1$, $\Gamma
    \tvdash{\theta} e_1:A$ and $\Gamma \tvdash{\theta'} e'_1:A'$ for
    some types $A$ and $A'$.  By the induction hypothesis, $e \in
    \interp{[e_1/x]e_2}^L_\rho$.  By  
    Lemma~\ref{lemma:lconv_in_interp_are_equiv},
    $\interp{[e_1/x]e_2}^L_\rho = \interp{[e'_1/x]e_2}^L_\rho$,
    thus, $e \in \interp{[e'_1/x]e_2}^L_\rho$.
  
  \item[]Case.\ \\
    \begin{center}
      $\FSdruleSucc{}$
    \end{center}
    Suppose $e \in \interp{\nat}^L_\rho$ then by CR-Norm $e$ is closed
    and $e \in N$, hence, $e \redto^* n$, where $n$ is a numeral.
    Clearly, $S\ n$ is closed and $S\ n \in N$, thus, $S\ n \in
    \interp{\nat}^L_{\rho[x \mapsto n]} = \interp{\nat}^L_\rho$.  
    Before we can apply CR-Prog we must show that $\cdot \tvdash{L} S\ e:\nat$.
    By the definition of the interpretation of types, $\cdot \tvdash{L} e:\nat$,
    and by assumption $\cdot \tvdash{L} S:\arrowT{x}{L}{\nat}{+}{e_2}$.  We can
    now apply $\FSdrulename{AppPiTerm}$ to obtain $\cdot \tvdash{L} S\ e:\nat$.
    Therefore, by CR-Prog, $S\ e \in \interp{\nat}^L_\rho$.
  
  \item[]Case.\ \\
    \begin{center}
      $\FSdruleZero{}$
    \end{center}
    Clearly, $Z$ is closed and $Z \in N$.  Thus, $Z \in
    \interp{\nat}^L_\rho$.

  \item[]Case.\ \\
    \begin{center}
      $\FSdruleContra{}$
    \end{center}
    By the induction hypothesis, $\rho\ e \in \interp{Z =
    S\ e'}^L_\rho$.  By the
    definition of the interpretation of types, $Z$ and $S\ e'$ are
    compatibly joinable, which is not the case, hence a
    contradiction.  Thus, we obtain that $contra \in
    \interp{e''}^L_\rho$ for any $e''$.
    
  \item[]Case.\ \\
    \begin{center}
      $\FSdruleContraAbort{}$
    \end{center}
    This case is similar to the previous case.

  \item[]Case.\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{ContraPiTh}] {
          \Gamma \tvdash{\theta''} e:[[Type]]
          \\\\
          \Gamma \tvdash{L} e':(\arrowT{x}{\theta}{e_1}{\epsilon}{e_2}) = 
          (\arrowT{x}{\theta'}{e'_1}{\epsilon'}{e'_2})
          \\\\
          \theta \neq \theta'
        }{\Gamma \tvdash{L} contra : e}
      \end{math}
    \end{center}
    The induction hypothesis allows us to conclude that $e'$ is a member of the 
    interpretation of its type which tells us that 
    $\rho\ (\arrowT{x}{\theta}{e_1}{\epsilon}{e_2}) \join 
    \rho\ (\arrowT{x}{\theta'}{e'_1}{\epsilon'}{e'_2}$, but this is a contradiction, because
    $\theta \neq \theta'$.  Therefore, $contra \in \interp{e}^L_\rho$.

  \item[]Case.\ \\
    \begin{center}
      \begin{math}
        $$\mprset{flushleft}
        \inferrule* [right=\FSdrulename{ContraPiEp}] {
          \Gamma \tvdash{\theta''} e:[[Type]]
          \\\\
          \Gamma \tvdash{L} e':(\arrowT{x}{\theta}{e_1}{\epsilon}{e_2}) = 
          (\arrowT{x}{\theta'}{e'_1}{\epsilon'}{e'_2})
          \\\\
          \epsilon \neq \epsilon'
        }{\Gamma \tvdash{L} contra : e}
      \end{math}
    \end{center}
    Similar to the previous case.
  
  \item[]Case.\ \\
    \begin{center}
      $\FSdruleRecNat{}$
    \end{center}
  
    We need to show that $\rho\ \rec{f}{x}{v} \equiv \rec{f}{x}{\rho\ v} \in $
    $\interp{\arrowT{x}{L}{\nat}{+}{e_2}}^L_\rho$.  By the
    definition of the interpretation of types, $\rec{f}{x}{\rho\ v}
    \in \interp{\arrowT{x}{L}{\nat}{+}{e_2}}^L_\rho$ iff for any $e
    \in \interp{\nat}^L_\rho$, we have $(\rec{f}{x}{\rho\ v})\ e
    \in \interp{e_2}^L_{\rho[x \mapsto e]}$, because $f \not \in FV(e_2)$.
    Let $e'$ be an arbitrary element of 
    $\interp{\nat}^L_\rho$.  By the definition of the interpretation of types,
    $e' \normto n \in N$, hence, $n \in V$ and by CR-Pres, $n \in
    \interp{\nat}^L_\rho$.  Thus, $(\rec{f}{x}{\rho\ v})\ e'
    \redto^* (\rec{f}{x}{\rho\ v})\ n \redto $
    $[n/x][\rec{f}{x}{\rho\ v}/f]\rho\ v$.  By the induction
    hypothesis, for any $\rho' \in $ $\interp{\Gamma,x:^L \nat,f:^L
    \arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x = S\ y}{-}{[y/x]e_2}}}$,
    we have $\rho'\ v \in \interp{e_2}^L_{\rho'}$.

    \noindent
    At this point we need to show that
    $[n/x][\rec{f}{x}{\rho\ v}/f]\rho \in $ $\interp{\Gamma,x:^L
    \nat,f:^L \arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x =
    S\ y}{-}{[y/x]e_2}}}$, but to conclude this we must have
    $\rec{f}{x}{\rho\ v} \in $
    $\interp{\arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x =
    S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto n]}$, which means
    we have to prove the following proposition.

  \noindent
  
  \begin{proposition}
    \label{prop:rec_interp_proof}
    For any $n \in \nat$, $\rec{f}{x}{\rho\ v} \in $
    $\interp{\arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x=S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto n]}$.
  \end{proposition}
  
  \noindent
  We proceed by induction on $n$.  For the base case let $n \equiv 0$.
  Then $\rec{f}{x}{\rho\ v} \in $
  $\interp{\arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto 0]}$ iff for any $e'
  \in \interp{\nat}^L_{\rho[x \mapsto 0]}$, we have
  $(\rec{f}{x}{\rho\ v})\ e' \in $ $\interp{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}^L_{\rho[x \mapsto 0][y \mapsto e']}$.
  Let $e''$ be an arbitrary element of $\interp{\nat}^L_{\rho[x \mapsto 0]}$.  Then we know 
  $e'' \in \interp{\nat}^L_{\rho[x
  \mapsto 0]}$ and $e'' \normto n \in N$, hence, $n \in V$.  Now
  we have to show that $(\rec{f}{x}{\rho\ v})\ e'' \redto^*
  (\rec{f}{x}{\rho\ v})\ n\in $ $\interp{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}^L_{\rho[x \mapsto 0][y \mapsto n]}$.  By
  the definition of the interpretation types we must show that for any
  $e''' \in \interp{x = S\ y}^L_{\rho[x \mapsto 0][y \mapsto n]}$, we
  have, $(\rec{f}{x}{\rho\ v})\ n \in $ $\interp{[y/x]e_2}_{\rho[x
  \mapsto 0][y \mapsto n][p \mapsto e''']}$.  Let 
  $a \in \interp{x = S\ y}^L_{\rho[x \mapsto 0][y \mapsto n]}$.
  By the definition of the interpretation, $a \join join$ and $0
  \join S\ n$, but this is a contradiction.

  \noindent
  Now let $n \equiv S\ n'$.  By the definition of the interpretation
  of types, $\rec{f}{x}{\rho\ v} \in
  \interp{\arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto n]}$ iff for any $a
  \in \interp{\nat}^L_{\rho[x \mapsto n]}$, we have
  $(\rec{f}{x}{\rho\ v})\ a \in \interp{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}^L_{\rho[x \mapsto n][y \mapsto a]}$.  Let
  $a'$ be an arbitrary $a$. By CR-Norm and the definition of the
  interpretation of types, $a' \in N$, $a' \in V$, hence, $a' \normto
  v' \in \nat$.  By CR-Pres and the definition of the interpretation of
  types, $(\rec{f}{x}{\rho\ v})\ a' \redto^*
  (\rec{f}{x}{\rho\ v})\ v' \in \interp{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}^L_{\rho[x \mapsto n][y \mapsto v']}$ iff
  for any $a'' \in \interp{x = S\ y}^L_{\rho[x \mapsto n][y \mapsto
  v']}$, we have $(\rec{f}{x}{\rho\ v})\ v' \in
  \interp{[y/x]e_2}^L_{\rho[x \mapsto n][y \mapsto v'][p \mapsto 
  a'']}$.  Let 
  $u \in \interp{x = S\ y}^L_{\rho[x \mapsto n][y \mapsto v']}$.  By the definition of the
  interpretation of types, $u \join join$ and $S\ n' \join S\ v'$,
  which implies $n' \join v'$.  Now $(\rec{f}{x}{\rho\ v})\ v'
  \redto [v'/x][\rec{f}{x}{\rho\ v}/f]\rho\ v$, so by CR-Pres it
  suffices to show, $[v'/x][\rec{f}{x}{\rho\ v}/f]\rho\ v \in
  \interp{[y/x]e_2}^L_{\rho[x \mapsto n][y \mapsto v'][p \mapsto
  u]}$.  It is easy to see that $x$ is not free in $[y/x]e_2$ and
  we know by assumption $p$ is also not free in $[y/x]e_2$, hence, 
  $\interp{[y/x]e_2}^L_{\rho[x \mapsto n][y \mapsto v'][p \mapsto u]} = 
  \interp{[y/x]e_2}^L_{\rho[y \mapsto v']}$, and by a simple renaming of variables,
  $\interp{[y/x]e_2}^L_{\rho[y \mapsto v']} =
  \interp{e_2}^L_{\rho[x \mapsto v']}$.  Thus, it suffices to show,
  $[v'/x][\rec{f}{x}{\rho\ v}/f]\rho\ v \in
  \interp{e_2}^L_{\rho[x \mapsto v']}$.  Finally, by 
  Lemma~\ref{lemma:movable_subs},
  it suffices to show, $[n'/x][\rec{f}{x}{\rho\ v}/f]\rho\ v \in
  \interp{e_2}^L_{\rho[x \mapsto n']}$, because $v' \join n'$.

  \noindent
  By the inner induction hypothesis, $\rec{f}{x}{\rho\ v} \in
  \interp{\arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto n']}$.
  Thus, $[n'/x][\rec{f}{x}{\rho\ v}/f]\rho \in
  \interp{\Gamma,x:^L \nat, f:^L
  \arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x = S\ y}{-}{[y/x]e_2}}}$.
  We can now apply the outer induction hypothesis, where we substitute
  $v$ for $e$, $e_2$ for $e'$, $\Gamma,x:^L \nat,f:^L
  \arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x = S\ y}{-}{[y/x]e_2}}$ for
  $\Gamma$, and $[n'/x][\rec{f}{x}{\rho\ v}/f]\rho$ for $\rho$,
  to obtain, $[n'/x][\rec{f}{x}{\rho\ v}/f]\rho\ v \in
  \interp{e_2}^L_{\rho[x \mapsto n'][f \mapsto
  \rec{f}{x}{\rho\ v}/f]} = \interp{e_2}^L_{\rho[x \mapsto
  n']}$, because $f \not \in FV(e_2)$.

  By Proposition~\ref{prop:rec_interp_proof}, $\rec{f}{x}{\rho\ v}
  \in $ $\interp{\arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto n]}$.  Thus,
  $[n/x][\rec{f}{x}{\rho\ v}/f]\rho \in $ $\interp{\Gamma,x:^L
  \nat,f:^L \arrowT{y}{L}{\nat}{+}{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}}$ and we can finally conclude,
  $[n/x][\rec{f}{x}{\rho\ v}/f]\rho\ v \in $
  $\interp{e_2}^L_{\rho[x \mapsto n]}$.  By
  CR-Pres, $(\rec{f}{x}{\rho\ v})\ e \in $ $\interp{e_2}^L_{\rho[x \mapsto n]}$.  
  Therefore, $\rec{f}{x}{\rho\ v} \in \interp{\arrowT{x}{L}{\nat}{+}{e_2}}^L_\rho$.

\item[]Case.\ \\
  \begin{center}
    $\FSdruleRecNatComp{}$
  \end{center}
  We must show, for any $a \in \interp{\nat}^L_{\rho}$, we have $\recc{f}{x}{\rho\ v} \in
  \interp{e_2}^L_{\rho[x \mapsto a]}$.  Let $a'$ be an arbitrary $a$.  Then by CR-Norm and the 
  interpretation of types, $a' \in N$, $a' \in V$
  and $a \normto n \in \nat$.  So $(\recc{f}{x}{\rho\ v})\ a \redto^* 
  (\recc{f}{x}{\rho\ v})\ n \redto [n/x][\recc{f}{x}{\rho\ v}/f]\rho\ v \equiv
  [\recc{f}{x}{\rho\ v}/f]\rho\ v$.  By CR-Pres it suffices to show, 
  $[\recc{f}{x}{\rho\ v}/f]\rho\ v \in \interp{e_2}^L_{\rho[x \mapsto n]}$.  To conclude this
  we have to show $[\recc{f}{x}{\rho\ v}/f]\rho \in \interp{\Gamma,x:^L \nat, f:^L 
  \arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x = S\ y}{-}{[y/x]e_2}}}$.  This requires us to prove the 
  following proposition.

  \noindent
  
  \begin{proposition}
    \label{prop:recc_interp_proof}
    For any $n \in \nat$, $\recc{f}{x}{\rho\ v} \in $
    $\interp{\arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x=S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto n]}$.
  \end{proposition}
  
  \noindent
  We proceed by induction on $n$.  For the base case let $n \equiv 0$.
  Then $\recc{f}{x}{\rho\ v} \in $
  $\interp{\arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto 0]}$ iff for any $e'
  \in \interp{\nat}^L_{\rho[x \mapsto 0]}$, we have
  $\recc{f}{x}{\rho\ v} \in $ $\interp{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}^L_{\rho[x \mapsto 0][y \mapsto e']}$.
  Let 
  $e'' \in \interp{\nat}^L_{\rho[x \mapsto 0]}$. Then, we know, 
  $e'' \normto n' \in N$, hence, $n' \in V$.  
  Now we have to show that $(\recc{f}{x}{\rho\ v})\ e'' \redto^*
  (\recc{f}{x}{\rho\ v})\ n' \equiv \recc{f}{x}{\rho\ v}
  \in $ $\interp{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}^L_{\rho[x \mapsto 0][y \mapsto n']}$.  By
  the definition of the interpretation types we must show that for any
  $e''' \in \interp{x = S\ y}^L_{\rho[x \mapsto 0][y \mapsto n']}$ we
  have $\recc{f}{x}{\rho\ v} \in $ $\interp{[y/x]e_2}_{\rho[x
  \mapsto 0][y \mapsto n'][p \mapsto e''']}$.  Let 
  $a \in \interp{x = S\ y}^L_{\rho[x \mapsto 0][y \mapsto n']}$.  
  Then by the definition of the interpretation, $a \join join$ and $0
  \join S\ n$, but this is a contradiction.

  \noindent
  Now let $n \equiv S\ n'$.  By the definition of the interpretation
  of types, $\recc{f}{x}{\rho\ v} \in
  \interp{\arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto n]}$ iff for any $a
  \in \interp{\nat}^L_{\rho[x \mapsto n]}$, we have
  $\recc{f}{x}{\rho\ v} \in \interp{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}^L_{\rho[x \mapsto n][y \mapsto a]}$.  Let
  $a'$ be an arbitrary $a$. Then by CR-Norm and the definition of the
  interpretation of types, $a' \in N$, $a' \in V$, hence, $a' \normto
  v' \in \nat$.  By CR-Pres and the definition of the interpretation of
  types, $(\recc{f}{x}{\rho\ v})\ a' \redto^*
  (\recc{f}{x}{\rho\ v})\ v' \equiv \recc{f}{x}{\rho\ v} \in 
  \interp{\arrowT{p}{L}{x = S\ y}{-}{[y/x]e_2}}^L_{\rho[x \mapsto n][y \mapsto v']}$ iff
  for any $a'' \in \interp{x = S\ y}^L_{\rho[x \mapsto n][y \mapsto v']}$, we have 
  $\recc{f}{x}{\rho\ v} \in
  \interp{[y/x]e_2}^L_{\rho[x \mapsto n][y \mapsto v'][p \mapsto 
  a'']}$. Suppose $u \in \interp{x = S\ y}^L_{\rho[x \mapsto n][y \mapsto v']}$.  
  By the definition of the
  interpretation of types, $u \join join$ and $S\ n' \join S\ v'$,
  which implies, $n' \join v'$.  Now $(\recc{f}{x}{\rho\ v})\ v'
  \redto [v'/x][\recc{f}{x}{\rho\ v}/f]\rho\ v \equiv 
  [\recc{f}{x}{\rho\ v}/f]\rho\ v$, so by CR-Pres it
  suffices to show, $[\recc{f}{x}{\rho\ v}/f]\rho\ v \in
  \interp{[y/x]e_2}^L_{\rho[x \mapsto n][y \mapsto v'][p \mapsto
  u]}$.  It is easy to see that $x$ is not free in $[y/x]e_2$ and
  we know $p$ is also not free
  in $[y/x]e_2$, hence, $\interp{[y/x]e_2}^L_{\rho[x \mapsto n][y
  \mapsto v'][p \mapsto u]} = \interp{[y/x]e_2}^L_{\rho[y
  \mapsto v']}$, and by a simple renaming of variables,
  $\interp{[y/x]e_2}^L_{\rho[y \mapsto v']} =
  \interp{e_2}^L_{\rho[x \mapsto v']}$.  Thus, it suffices to show,
  $[\recc{f}{x}{\rho\ v}/f]\rho\ v \in
  \interp{e_2}^L_{\rho[x \mapsto v']}$.  Finally, by  
  Lemma~\ref{lemma:movable_subs},
  it suffices to show, $[\recc{f}{x}{\rho\ v}/f]\rho\ v \in
  \interp{e_2}^L_{\rho[x \mapsto n']}$, because $v' \join n'$.

  \noindent
  By the inner induction hypothesis, $\recc{f}{x}{\rho\ v} \in
  \interp{\arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto n']}$.
  Thus, $[\recc{f}{x}{\rho\ v}/f]\rho \in
  \interp{\Gamma,x:^L \nat, f:^L
  \arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x = S\ y}{-}{[y/x]e_2}}}$.
  We can now apply the outer induction hypothesis, where we substitute
  $v$ for $e$, $e_2$ for $e'$, $\Gamma,x:^L \nat,f:^L
  \arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x = S\ y}{-}{[y/x]e_2}}$ for
  $\Gamma$, and $[\recc{f}{x}{\rho\ v}/f]\rho$ for $\rho$,
  to obtain, $[\recc{f}{x}{\rho\ v}/f]\rho\ v \in
  \interp{e_2}^L_{\rho[x \mapsto n'][f \mapsto
  \recc{f}{x}{\rho\ v}/f]} = \interp{e_2}^L_{\rho[x \mapsto
  n']}$, because $f \not \in FV(e_2)$.

  By Proposition~\ref{prop:rec_interp_proof}, $\recc{f}{x}{\rho\ v}
  \in $ $\interp{\arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}}^L_{\rho[x \mapsto n]}$.  Thus,
  $[\recc{f}{x}{\rho\ v}/f]\rho \in $ $\interp{\Gamma,x:^L
  \nat,f:^L \arrowT{y}{L}{\nat}{-}{\arrowT{p}{L}{x =
  S\ y}{-}{[y/x]e_2}}}$ and we can finally conclude,
  $[\recc{f}{x}{\rho\ v}/f]\rho\ v \in $
  $\interp{e_2}^L_{\rho[x \mapsto n]}$.  By
  CR-Pres, $\recc{f}{x}{\rho\ v} \in $ $\interp{e_2}^L_{\rho[x \mapsto n]}$.  Therefore,
  $\recc{f}{x}{\rho\ v} \in $
  $\interp{\arrowT{x}{L}{\nat}{-}{e_2}}^L_\rho$.
\end{itemize}
\end{proof}
% section logical_consistency (end)

%%% Local Variables: ***
%%% mode: latex ***
%%% TeX-master: "thesis.tex" ***
%%% End: ***